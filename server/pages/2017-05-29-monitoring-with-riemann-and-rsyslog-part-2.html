<!DOCTYPE html><html><head><link rel="icon" href="https://media.made.com/mws-assets/images/favicon.1.ico"/><link media="screen,handheld" type="text/css" rel="stylesheet" href="https://media.made.com/mws-assets/fontBase_b900f8d534cc10f95604.css"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Monitoring with Riemann and rsyslog part 2</title><meta name="next-head-count" content="3"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-24780b5468e42e63.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-a56127814584ab09.js" defer=""></script><script src="/_next/static/chunks/pages/_app-063d0cdbbc8e6a9c.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-88f3a092f15cc647.js" defer=""></script><script src="/_next/static/ZySGEpxrfAgPLUApbPe4o/_buildManifest.js" defer=""></script><script src="/_next/static/ZySGEpxrfAgPLUApbPe4o/_ssgManifest.js" defer=""></script><script src="/_next/static/ZySGEpxrfAgPLUApbPe4o/_middlewareManifest.js" defer=""></script></head><body><script>(function setScript(initialValue) {
  var mql = window.matchMedia("(prefers-color-scheme: dark)");
  var systemPreference = mql.matches ? "dark" : "light";
  var persistedPreference = systemPreference;

  try {
    persistedPreference = localStorage.getItem("chakra-ui-color-mode");
  } catch (error) {
    console.log("Chakra UI: localStorage is not available. Color mode persistence might not work as expected");
  }

  var colorMode;

  if (persistedPreference) {
    colorMode = persistedPreference;
  } else if (initialValue === "system") {
    colorMode = systemPreference;
  } else {
    colorMode = initialValue != null ? initialValue : systemPreference;
  }

  if (colorMode) {
    /**
     * Keep in sync with `root.set() {@file ./color-mode.utils.ts}
     */
    document.documentElement.style.setProperty("--chakra-ui-color-mode", colorMode);
    document.documentElement.setAttribute("data-theme", colorMode);
  }
})('light')</script><div id="__next" data-reactroot=""><style data-emotion="css-global 1co9hnp">:host,:root{--chakra-ring-inset:var(--chakra-empty,/*!*/ /*!*/);--chakra-ring-offset-width:0px;--chakra-ring-offset-color:#fff;--chakra-ring-color:rgba(66, 153, 225, 0.6);--chakra-ring-offset-shadow:0 0 #0000;--chakra-ring-shadow:0 0 #0000;--chakra-space-x-reverse:0;--chakra-space-y-reverse:0;--chakra-colors-transparent:transparent;--chakra-colors-current:currentColor;--chakra-colors-black:#000000;--chakra-colors-white:#FFFFFF;--chakra-colors-whiteAlpha-50:rgba(255, 255, 255, 0.04);--chakra-colors-whiteAlpha-100:rgba(255, 255, 255, 0.06);--chakra-colors-whiteAlpha-200:rgba(255, 255, 255, 0.08);--chakra-colors-whiteAlpha-300:rgba(255, 255, 255, 0.16);--chakra-colors-whiteAlpha-400:rgba(255, 255, 255, 0.24);--chakra-colors-whiteAlpha-500:rgba(255, 255, 255, 0.36);--chakra-colors-whiteAlpha-600:rgba(255, 255, 255, 0.48);--chakra-colors-whiteAlpha-700:rgba(255, 255, 255, 0.64);--chakra-colors-whiteAlpha-800:rgba(255, 255, 255, 0.80);--chakra-colors-whiteAlpha-900:rgba(255, 255, 255, 0.92);--chakra-colors-blackAlpha-50:rgba(0, 0, 0, 0.04);--chakra-colors-blackAlpha-100:rgba(0, 0, 0, 0.06);--chakra-colors-blackAlpha-200:rgba(0, 0, 0, 0.08);--chakra-colors-blackAlpha-300:rgba(0, 0, 0, 0.16);--chakra-colors-blackAlpha-400:rgba(0, 0, 0, 0.24);--chakra-colors-blackAlpha-500:rgba(0, 0, 0, 0.36);--chakra-colors-blackAlpha-600:rgba(0, 0, 0, 0.48);--chakra-colors-blackAlpha-700:rgba(0, 0, 0, 0.64);--chakra-colors-blackAlpha-800:rgba(0, 0, 0, 0.80);--chakra-colors-blackAlpha-900:rgba(0, 0, 0, 0.92);--chakra-colors-gray-50:#F7FAFC;--chakra-colors-gray-100:#EDF2F7;--chakra-colors-gray-200:#E2E8F0;--chakra-colors-gray-300:#CBD5E0;--chakra-colors-gray-400:#A0AEC0;--chakra-colors-gray-500:#718096;--chakra-colors-gray-600:#4A5568;--chakra-colors-gray-700:#2D3748;--chakra-colors-gray-800:#1A202C;--chakra-colors-gray-900:#171923;--chakra-colors-red-5:#fff2f0;--chakra-colors-red-10:#ffdfdd;--chakra-colors-red-50:#F15856;--chakra-colors-red-80:#d03740;--chakra-colors-red-100:#FED7D7;--chakra-colors-red-200:#FEB2B2;--chakra-colors-red-300:#FC8181;--chakra-colors-red-400:#F56565;--chakra-colors-red-500:#E53E3E;--chakra-colors-red-600:#C53030;--chakra-colors-red-700:#9B2C2C;--chakra-colors-red-800:#822727;--chakra-colors-red-900:#63171B;--chakra-colors-orange-50:#FFFAF0;--chakra-colors-orange-100:#FEEBC8;--chakra-colors-orange-200:#FBD38D;--chakra-colors-orange-300:#F6AD55;--chakra-colors-orange-400:#ED8936;--chakra-colors-orange-500:#DD6B20;--chakra-colors-orange-600:#C05621;--chakra-colors-orange-700:#9C4221;--chakra-colors-orange-800:#7B341E;--chakra-colors-orange-900:#652B19;--chakra-colors-yellow-50:#FFFFF0;--chakra-colors-yellow-100:#FEFCBF;--chakra-colors-yellow-200:#FAF089;--chakra-colors-yellow-300:#F6E05E;--chakra-colors-yellow-400:#ECC94B;--chakra-colors-yellow-500:#D69E2E;--chakra-colors-yellow-600:#B7791F;--chakra-colors-yellow-700:#975A16;--chakra-colors-yellow-800:#744210;--chakra-colors-yellow-900:#5F370E;--chakra-colors-green-5:#e4fbe5;--chakra-colors-green-10:#ccf5ce;--chakra-colors-green-50:#30a75b;--chakra-colors-green-80:#008248;--chakra-colors-green-100:#C6F6D5;--chakra-colors-green-200:#9AE6B4;--chakra-colors-green-300:#68D391;--chakra-colors-green-400:#48BB78;--chakra-colors-green-500:#38A169;--chakra-colors-green-600:#2F855A;--chakra-colors-green-700:#276749;--chakra-colors-green-800:#22543D;--chakra-colors-green-900:#1C4532;--chakra-colors-teal-50:#E6FFFA;--chakra-colors-teal-100:#B2F5EA;--chakra-colors-teal-200:#81E6D9;--chakra-colors-teal-300:#4FD1C5;--chakra-colors-teal-400:#38B2AC;--chakra-colors-teal-500:#319795;--chakra-colors-teal-600:#2C7A7B;--chakra-colors-teal-700:#285E61;--chakra-colors-teal-800:#234E52;--chakra-colors-teal-900:#1D4044;--chakra-colors-blue-50:#ebf8ff;--chakra-colors-blue-100:#bee3f8;--chakra-colors-blue-200:#90cdf4;--chakra-colors-blue-300:#63b3ed;--chakra-colors-blue-400:#4299e1;--chakra-colors-blue-500:#3182ce;--chakra-colors-blue-600:#2b6cb0;--chakra-colors-blue-700:#2c5282;--chakra-colors-blue-800:#2a4365;--chakra-colors-blue-900:#1A365D;--chakra-colors-cyan-50:#EDFDFD;--chakra-colors-cyan-100:#C4F1F9;--chakra-colors-cyan-200:#9DECF9;--chakra-colors-cyan-300:#76E4F7;--chakra-colors-cyan-400:#0BC5EA;--chakra-colors-cyan-500:#00B5D8;--chakra-colors-cyan-600:#00A3C4;--chakra-colors-cyan-700:#0987A0;--chakra-colors-cyan-800:#086F83;--chakra-colors-cyan-900:#065666;--chakra-colors-purple-50:#FAF5FF;--chakra-colors-purple-100:#E9D8FD;--chakra-colors-purple-200:#D6BCFA;--chakra-colors-purple-300:#B794F4;--chakra-colors-purple-400:#9F7AEA;--chakra-colors-purple-500:#805AD5;--chakra-colors-purple-600:#6B46C1;--chakra-colors-purple-700:#553C9A;--chakra-colors-purple-800:#44337A;--chakra-colors-purple-900:#322659;--chakra-colors-pink-50:#FFF5F7;--chakra-colors-pink-100:#FED7E2;--chakra-colors-pink-200:#FBB6CE;--chakra-colors-pink-300:#F687B3;--chakra-colors-pink-400:#ED64A6;--chakra-colors-pink-500:#D53F8C;--chakra-colors-pink-600:#B83280;--chakra-colors-pink-700:#97266D;--chakra-colors-pink-800:#702459;--chakra-colors-pink-900:#521B41;--chakra-colors-linkedin-50:#E8F4F9;--chakra-colors-linkedin-100:#CFEDFB;--chakra-colors-linkedin-200:#9BDAF3;--chakra-colors-linkedin-300:#68C7EC;--chakra-colors-linkedin-400:#34B3E4;--chakra-colors-linkedin-500:#00A0DC;--chakra-colors-linkedin-600:#008CC9;--chakra-colors-linkedin-700:#0077B5;--chakra-colors-linkedin-800:#005E93;--chakra-colors-linkedin-900:#004471;--chakra-colors-facebook-50:#E8F4F9;--chakra-colors-facebook-100:#D9DEE9;--chakra-colors-facebook-200:#B7C2DA;--chakra-colors-facebook-300:#6482C0;--chakra-colors-facebook-400:#4267B2;--chakra-colors-facebook-500:#385898;--chakra-colors-facebook-600:#314E89;--chakra-colors-facebook-700:#29487D;--chakra-colors-facebook-800:#223B67;--chakra-colors-facebook-900:#1E355B;--chakra-colors-messenger-50:#D0E6FF;--chakra-colors-messenger-100:#B9DAFF;--chakra-colors-messenger-200:#A2CDFF;--chakra-colors-messenger-300:#7AB8FF;--chakra-colors-messenger-400:#2E90FF;--chakra-colors-messenger-500:#0078FF;--chakra-colors-messenger-600:#0063D1;--chakra-colors-messenger-700:#0052AC;--chakra-colors-messenger-800:#003C7E;--chakra-colors-messenger-900:#002C5C;--chakra-colors-whatsapp-50:#dffeec;--chakra-colors-whatsapp-100:#b9f5d0;--chakra-colors-whatsapp-200:#90edb3;--chakra-colors-whatsapp-300:#65e495;--chakra-colors-whatsapp-400:#3cdd78;--chakra-colors-whatsapp-500:#22c35e;--chakra-colors-whatsapp-600:#179848;--chakra-colors-whatsapp-700:#0c6c33;--chakra-colors-whatsapp-800:#01421c;--chakra-colors-whatsapp-900:#001803;--chakra-colors-twitter-50:#E5F4FD;--chakra-colors-twitter-100:#C8E9FB;--chakra-colors-twitter-200:#A8DCFA;--chakra-colors-twitter-300:#83CDF7;--chakra-colors-twitter-400:#57BBF5;--chakra-colors-twitter-500:#1DA1F2;--chakra-colors-twitter-600:#1A94DA;--chakra-colors-twitter-700:#1681BF;--chakra-colors-twitter-800:#136B9E;--chakra-colors-twitter-900:#0D4D71;--chakra-colors-telegram-50:#E3F2F9;--chakra-colors-telegram-100:#C5E4F3;--chakra-colors-telegram-200:#A2D4EC;--chakra-colors-telegram-300:#7AC1E4;--chakra-colors-telegram-400:#47A9DA;--chakra-colors-telegram-500:#0088CC;--chakra-colors-telegram-600:#007AB8;--chakra-colors-telegram-700:#006BA1;--chakra-colors-telegram-800:#005885;--chakra-colors-telegram-900:#003F5E;--chakra-colors-made-5:#fafafa;--chakra-colors-made-10:#f5f6f4;--chakra-colors-made-20:#eef0ed;--chakra-colors-made-30:#e1e3de;--chakra-colors-made-40:#bdbfbb;--chakra-colors-made-50:#9fa19d;--chakra-colors-made-60:#767874;--chakra-colors-made-70:#626360;--chakra-colors-made-80:#434442;--chakra-colors-made-90:#222321;--chakra-colors-made-black:#131413;--chakra-colors-made-baige:#d9c3b8;--chakra-colors-made-green:#c0d0cf;--chakra-colors-made-grey:#d7d3d0;--chakra-colors-made-blue:#353F7D;--chakra-borders-none:0;--chakra-borders-1px:1px solid;--chakra-borders-2px:2px solid;--chakra-borders-4px:4px solid;--chakra-borders-8px:8px solid;--chakra-fonts-heading:FS Neruda;--chakra-fonts-body:FS Meridian Regular,sans-serif;--chakra-fonts-mono:FS Hack;--chakra-fontSizes-xs:0.75rem;--chakra-fontSizes-sm:0.875rem;--chakra-fontSizes-md:1rem;--chakra-fontSizes-lg:1.125rem;--chakra-fontSizes-xl:1.25rem;--chakra-fontSizes-2xl:1.5rem;--chakra-fontSizes-3xl:1.875rem;--chakra-fontSizes-4xl:2.25rem;--chakra-fontSizes-5xl:3rem;--chakra-fontSizes-6xl:3.75rem;--chakra-fontSizes-7xl:4.5rem;--chakra-fontSizes-8xl:6rem;--chakra-fontSizes-9xl:8rem;--chakra-fontWeights-hairline:100;--chakra-fontWeights-thin:200;--chakra-fontWeights-light:300;--chakra-fontWeights-normal:400;--chakra-fontWeights-medium:500;--chakra-fontWeights-semibold:600;--chakra-fontWeights-bold:700;--chakra-fontWeights-extrabold:800;--chakra-fontWeights-black:900;--chakra-letterSpacings-tighter:-0.05em;--chakra-letterSpacings-tight:-0.025em;--chakra-letterSpacings-normal:0;--chakra-letterSpacings-wide:0.025em;--chakra-letterSpacings-wider:0.05em;--chakra-letterSpacings-widest:0.1em;--chakra-lineHeights-3:.75rem;--chakra-lineHeights-4:1rem;--chakra-lineHeights-5:1.25rem;--chakra-lineHeights-6:1.5rem;--chakra-lineHeights-7:1.75rem;--chakra-lineHeights-8:2rem;--chakra-lineHeights-9:2.25rem;--chakra-lineHeights-10:2.5rem;--chakra-lineHeights-normal:normal;--chakra-lineHeights-none:1;--chakra-lineHeights-shorter:1.25;--chakra-lineHeights-short:1.375;--chakra-lineHeights-base:1.5;--chakra-lineHeights-tall:1.625;--chakra-lineHeights-taller:2;--chakra-radii-none:0;--chakra-radii-sm:0.125rem;--chakra-radii-base:0.25rem;--chakra-radii-md:0.375rem;--chakra-radii-lg:0.5rem;--chakra-radii-xl:0.75rem;--chakra-radii-2xl:1rem;--chakra-radii-3xl:1.5rem;--chakra-radii-full:9999px;--chakra-space-1:0.25rem;--chakra-space-2:0.5rem;--chakra-space-3:0.75rem;--chakra-space-4:1rem;--chakra-space-5:1.25rem;--chakra-space-6:1.5rem;--chakra-space-7:1.75rem;--chakra-space-8:2rem;--chakra-space-9:2.25rem;--chakra-space-10:2.5rem;--chakra-space-12:3rem;--chakra-space-14:3.5rem;--chakra-space-16:4rem;--chakra-space-20:5rem;--chakra-space-24:6rem;--chakra-space-28:7rem;--chakra-space-32:8rem;--chakra-space-36:9rem;--chakra-space-40:10rem;--chakra-space-44:11rem;--chakra-space-48:12rem;--chakra-space-52:13rem;--chakra-space-56:14rem;--chakra-space-60:15rem;--chakra-space-64:16rem;--chakra-space-72:18rem;--chakra-space-80:20rem;--chakra-space-96:24rem;--chakra-space-px:1px;--chakra-space-0-5:0.125rem;--chakra-space-1-5:0.375rem;--chakra-space-2-5:0.625rem;--chakra-space-3-5:0.875rem;--chakra-shadows-xs:0 0 0 1px rgba(0, 0, 0, 0.05);--chakra-shadows-sm:0 1px 2px 0 rgba(0, 0, 0, 0.05);--chakra-shadows-base:0 1px 3px 0 rgba(0, 0, 0, 0.1),0 1px 2px 0 rgba(0, 0, 0, 0.06);--chakra-shadows-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--chakra-shadows-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);--chakra-shadows-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1),0 10px 10px -5px rgba(0, 0, 0, 0.04);--chakra-shadows-2xl:0 25px 50px -12px rgba(0, 0, 0, 0.25);--chakra-shadows-outline:0 0 0 3px rgba(66, 153, 225, 0.6);--chakra-shadows-inner:inset 0 2px 4px 0 rgba(0,0,0,0.06);--chakra-shadows-none:none;--chakra-shadows-dark-lg:rgba(0, 0, 0, 0.1) 0px 0px 0px 1px,rgba(0, 0, 0, 0.2) 0px 5px 10px,rgba(0, 0, 0, 0.4) 0px 15px 40px;--chakra-sizes-1:0.25rem;--chakra-sizes-2:0.5rem;--chakra-sizes-3:0.75rem;--chakra-sizes-4:1rem;--chakra-sizes-5:1.25rem;--chakra-sizes-6:1.5rem;--chakra-sizes-7:1.75rem;--chakra-sizes-8:2rem;--chakra-sizes-9:2.25rem;--chakra-sizes-10:2.5rem;--chakra-sizes-12:3rem;--chakra-sizes-14:3.5rem;--chakra-sizes-16:4rem;--chakra-sizes-20:5rem;--chakra-sizes-24:6rem;--chakra-sizes-28:7rem;--chakra-sizes-32:8rem;--chakra-sizes-36:9rem;--chakra-sizes-40:10rem;--chakra-sizes-44:11rem;--chakra-sizes-48:12rem;--chakra-sizes-52:13rem;--chakra-sizes-56:14rem;--chakra-sizes-60:15rem;--chakra-sizes-64:16rem;--chakra-sizes-72:18rem;--chakra-sizes-80:20rem;--chakra-sizes-96:24rem;--chakra-sizes-px:1px;--chakra-sizes-0-5:0.125rem;--chakra-sizes-1-5:0.375rem;--chakra-sizes-2-5:0.625rem;--chakra-sizes-3-5:0.875rem;--chakra-sizes-max:max-content;--chakra-sizes-min:min-content;--chakra-sizes-full:100%;--chakra-sizes-3xs:14rem;--chakra-sizes-2xs:16rem;--chakra-sizes-xs:20rem;--chakra-sizes-sm:24rem;--chakra-sizes-md:28rem;--chakra-sizes-lg:32rem;--chakra-sizes-xl:36rem;--chakra-sizes-2xl:42rem;--chakra-sizes-3xl:48rem;--chakra-sizes-4xl:56rem;--chakra-sizes-5xl:64rem;--chakra-sizes-6xl:72rem;--chakra-sizes-7xl:80rem;--chakra-sizes-8xl:90rem;--chakra-sizes-container-sm:640px;--chakra-sizes-container-md:768px;--chakra-sizes-container-lg:1024px;--chakra-sizes-container-xl:1280px;--chakra-zIndices-hide:-1;--chakra-zIndices-auto:auto;--chakra-zIndices-base:0;--chakra-zIndices-docked:10;--chakra-zIndices-dropdown:1000;--chakra-zIndices-sticky:1100;--chakra-zIndices-banner:1200;--chakra-zIndices-overlay:1300;--chakra-zIndices-modal:1400;--chakra-zIndices-popover:1500;--chakra-zIndices-skipLink:1600;--chakra-zIndices-toast:1700;--chakra-zIndices-tooltip:1800;--chakra-transition-property-common:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform;--chakra-transition-property-colors:background-color,border-color,color,fill,stroke;--chakra-transition-property-dimensions:width,height;--chakra-transition-property-position:left,right,top,bottom;--chakra-transition-property-background:background-color,background-image,background-position;--chakra-transition-easing-ease-in:cubic-bezier(0.4, 0, 1, 1);--chakra-transition-easing-ease-out:cubic-bezier(0, 0, 0.2, 1);--chakra-transition-easing-ease-in-out:cubic-bezier(0.4, 0, 0.2, 1);--chakra-transition-duration-ultra-fast:50ms;--chakra-transition-duration-faster:100ms;--chakra-transition-duration-fast:150ms;--chakra-transition-duration-normal:200ms;--chakra-transition-duration-slow:300ms;--chakra-transition-duration-slower:400ms;--chakra-transition-duration-ultra-slow:500ms;--chakra-blur-none:0;--chakra-blur-sm:4px;--chakra-blur-base:8px;--chakra-blur-md:12px;--chakra-blur-lg:16px;--chakra-blur-xl:24px;--chakra-blur-2xl:40px;--chakra-blur-3xl:64px;}</style><style data-emotion="css-global 1jqlf9g">html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale;touch-action:manipulation;}body{position:relative;min-height:100%;font-feature-settings:'kern';}*,*::before,*::after{border-width:0;border-style:solid;box-sizing:border-box;}main{display:block;}hr{border-top-width:1px;box-sizing:content-box;height:0;overflow:visible;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:1em;}a{background-color:transparent;color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bold;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none!important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none!important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}template{display:none;}[hidden]{display:none!important;}body,blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0!important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}img,svg,video,canvas,audio,iframe,embed,object{display:block;}img,video{max-width:100%;height:auto;}[data-js-focus-visible] :focus:not([data-focus-visible-added]){outline:none;box-shadow:none;}select::-ms-expand{display:none;}</style><style data-emotion="css-global 1baqkrf">body{font-family:var(--chakra-fonts-body);color:var(--chakra-colors-gray-800);background:var(--chakra-colors-white);transition-property:background-color;transition-duration:var(--chakra-transition-duration-normal);line-height:var(--chakra-lineHeights-base);}*::-webkit-input-placeholder{color:var(--chakra-colors-gray-400);}*::-moz-placeholder{color:var(--chakra-colors-gray-400);}*:-ms-input-placeholder{color:var(--chakra-colors-gray-400);}*::placeholder{color:var(--chakra-colors-gray-400);}*,*::before,::after{border-color:var(--chakra-colors-gray-200);word-wrap:break-word;}</style><style data-emotion="css mfxtb">.css-mfxtb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;box-shadow:var(--chakra-shadows-base);width:100%;margin-bottom:var(--chakra-space-8);padding:var(--chakra-space-8);}</style><header class="css-mfxtb"><style data-emotion="css 18ci58h">.css-18ci58h{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:var(--chakra-sizes-8xl);width:100%;margin:auto;}</style><div class="css-18ci58h"><div class="css-0"><a href="/"><img alt="Logo" src="https://media.made.com/mws-assets/images/MadeLogo.2.svg" class="chakra-image css-0" aria-label="Logo"/></a></div><style data-emotion="css 1wsmmqi">@media screen and (min-width: 30em){.css-1wsmmqi{display:block;}}@media screen and (min-width: 48em){.css-1wsmmqi{display:none;}}</style><div class="css-1wsmmqi"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div><style data-emotion="css 3txhs">.css-3txhs{display:none;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;margin-left:auto;}@media screen and (min-width: 48em){.css-3txhs{display:block;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;}}</style><div class="css-3txhs"><style data-emotion="css 1lpw2d">.css-1lpw2d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding-top:var(--chakra-space-4);}.css-1lpw2d>*:not(style)~*:not(style){margin-top:var(--chakra-space-8);-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:0px;margin-inline-start:0px;}@media screen and (min-width: 30em){.css-1lpw2d{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding-top:var(--chakra-space-4);}.css-1lpw2d>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:var(--chakra-space-8);margin-inline-start:var(--chakra-space-8);}}@media screen and (min-width: 48em){.css-1lpw2d{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding-top:0px;}.css-1lpw2d>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:var(--chakra-space-8);margin-inline-start:var(--chakra-space-8);}}@media screen and (min-width: 62em){.css-1lpw2d{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding-top:0px;}.css-1lpw2d>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:var(--chakra-space-8);margin-inline-start:var(--chakra-space-8);}}</style><div class="chakra-stack css-1lpw2d"><style data-emotion="css f4h6uy">.css-f4h6uy{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:inherit;}.css-f4h6uy:hover,.css-f4h6uy[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-f4h6uy:focus,.css-f4h6uy[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a target="" class="chakra-link css-f4h6uy" href="/"><style data-emotion="css 1twuvi0">.css-1twuvi0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;width:100%;}.css-1twuvi0>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:0.5rem;margin-inline-start:0.5rem;}</style><div class="chakra-stack css-1twuvi0"><p class="chakra-text css-0">Home</p></div></a><a target="_blank" class="chakra-link css-f4h6uy" href="https://www.made.com/careers"><div class="chakra-stack css-1twuvi0"><p class="chakra-text css-0">Careers</p><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></div></a></div></div></div></header><style data-emotion="css rkbxzj">.css-rkbxzj{width:100%;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:var(--chakra-sizes-4xl);-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem;}</style><div class="chakra-container css-rkbxzj"><style data-emotion="css 1xr7jem">.css-1xr7jem{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-5xl);line-height:1;margin-bottom:var(--chakra-space-6);}@media screen and (min-width: 48em){.css-1xr7jem{font-size:var(--chakra-fontSizes-6xl);}}</style><h1 class="chakra-heading css-1xr7jem">Monitoring with Riemann and rsyslog part 2</h1><style data-emotion="css 1iv087f">.css-1iv087f{margin-bottom:var(--chakra-space-2);font-weight:var(--chakra-fontWeights-bold);}</style><p class="chakra-text css-1iv087f">by <!-- -->Bob</p><style data-emotion="css b64cj9">.css-b64cj9{margin-bottom:var(--chakra-space-4);color:var(--chakra-colors-made-50);}</style><p class="chakra-text css-b64cj9">Mon May 29 2017</p><style data-emotion="css rszk63">.css-rszk63{margin-bottom:var(--chakra-space-4);}</style><p class="chakra-text css-rszk63">It&#x27;s been a little longer than I expected, but I&#x27;m finally back and working on Rsyslog.
Last time <!-- -->[http://io.made.com/blog/monitoring-with-riemann-and-rsyslog-part-1/]<!-- -->, we
looked at how impstats could be used to generate internal metrics from Rsyslog, and how
to alert on those metrics in Riemann.</p><p class="chakra-text css-rszk63">This time I want to look at how the Dynstats module
<!-- -->[http://www.rsyslog.com/doc/master/configuration/dyn_stats.html]<!-- --> in Riemann can be used
to do more interesting monitoring of our applications.</p><p class="chakra-text css-rszk63">The Dynstats module provides a simple interface for counting events in Rsyslog. Any time
we see a particular pattern in our logs, or we receive a log file from a particular
application, we can increment a counter.</p><p class="chakra-text css-rszk63">For our first use-case, we&#x27;re going to use this to record error counts for each of our
applications. This is one of the simplest and most important metrics that you can
capture since most production issues will cause an increase in error rate. When the
&quot;Error Rate &gt; Threshold&quot; alarm goes off, it could be a bad deploy, a misconfigured app,
a bug in your code, or a failing disk on the database server. While you definitely want
more granular metrics to help you diagnose problems, this broad approach is fantastic as
an early warning system.</p><p class="chakra-text css-rszk63">For this post, I&#x27;ve put together a docker-compose playground
<!-- -->[https://github.com/bobthemighty/rek-stack-demos]<!-- -->. If you want to play along, you&#x27;ll
need a recent version of Docker Compose. Check out the code, and take a look in the
dynstats/dummy directory.</p><p class="chakra-text css-rszk63">To demonstrate a error counter, I&#x27;ve written a quick and dirty Go program that randomly
outputs either a notice or error level log at regular intervals. We can set the
interval, log tag, and error percentage on the command line.</p><p class="chakra-text css-rszk63">docker-compose run dummy -interval 100 -tag foo</p><p class="chakra-text css-rszk63">We can use the dynstats functionality in Rsyslog to count the number of errors that
happen in a 10-second window, and send the counter over to Riemann.</p><style data-emotion="css 1i61012">.css-1i61012{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-6xl);line-height:1;}@media screen and (min-width: 48em){.css-1i61012{font-size:var(--chakra-fontSizes-7xl);}}</style><h1 class="chakra-heading css-1i61012">We use the dyn_stats function to create a new metrics bucket.</h1><h1 class="chakra-heading css-1i61012">Each bucket can contain many counters.</h1><p class="chakra-text css-rszk63">dyn_stats(name=&quot;error_rate&quot;)</p><h1 class="chakra-heading css-1i61012">When we receive an &quot;error&quot; log, we will add 1 to the counter</h1><h1 class="chakra-heading css-1i61012">for the application that raised the error. We use the $programname</h1><h1 class="chakra-heading css-1i61012">parsed from the Syslog tag to identify the application.</h1><p class="chakra-text css-rszk63">if
($syslogseverity-text == &quot;error&quot;) then { set $foo = dyn_inc(&quot;error_rate&quot;,
$programname);
}</p><h1 class="chakra-heading css-1i61012">Lastly, here&#x27;s our stats processing.</h1><h1 class="chakra-heading css-1i61012">Parse the JSON that impstats forwards to us and spit it straight out to Riemann</h1><p class="chakra-text css-rszk63">ruleset(name=&quot;stats&quot;) { action(name=&quot;parse-stats&quot; type=&quot;mmjsonparse&quot;)
action(name=&quot;send-to-riemann&quot; type=&quot;omriemann&quot; subtree=&quot;!&quot; server=&quot;riemann&quot;) }</p><p class="chakra-text css-rszk63">We can bring this up by running docker-compose up from the root of the demo project.
After everything has started up, you should start to see regular metrics counting the
number of errors.</p><p class="chakra-text css-rszk63">riemann_1 | INFO <!-- -->[2017-05-29 09:26:11,285]<!-- --> defaultEventExecutorGroup-2-1 -
riemann.config - error rate/dummy-logger = 9 riemann_1 | INFO <!-- -->[2017-05-29 09:26:21,259]<!-- -->
defaultEventExecutorGroup-2-1 - riemann.config - error rate/dummy-logger = 16</p><p class="chakra-text css-rszk63">We can extend our Riemann config so that we raise an error if a metric is above an
absolute threshold. Open the file riemann/riemann.config . We&#x27;re going to edit the
config to add a new rule: when the error_rate is &gt; 10, log an error. In practice, we
would want to send an alert to an operator via email, Slack, or PagerDuty. Add the
following line below the prn on line 13:</p><div class="remark-highlight"><pre class="language-unknown"><style data-emotion="css e69dqy">.css-e69dqy{position:relative;z-index:0;}</style><div class="css-e69dqy"><style data-emotion="css 13wyh5o">.css-13wyh5o{padding:var(--chakra-space-5);overflow:hidden;background:var(--chakra-colors-orange-50);border-radius:10px;margin-bottom:var(--chakra-space-10);font-size:var(--chakra-fontSizes-sm);box-shadow:var(--chakra-shadows-lg);}</style><div class="css-13wyh5o"><div class="css-0">    (where (&amp;lt; 10 metric) #(error &amp;quot;Alert! error rate is now &amp;quot; (:metric %)))</div></div></div></pre></div><p class="chakra-text css-rszk63">Restart everything with docker-compose restart and wait a few seconds. You should start
to see output like this:</p><p class="chakra-text css-rszk63">riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - error
rate/dummy-logger = 9 riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config -
error rate/dummy-logger = 15 riemann_1 | ERROR - Alert! error rate is now 15</p><p class="chakra-text css-rszk63">For our second use case, we&#x27;re going to look at how dynstats and riemann can give us
some monitoring of web applications. One of the strong points of rsyslog is its ability
to rapidly parse large amounts of log text and pull out meaningful fields. Rsyslog can
parse logs fast enough that we can use it for realtime monitoring of applications. Using
mmnormalize, dynstats, and omriemann we can monitor our web applications in
near-realtime and see a breakdown of HTTP status codes.</p><p class="chakra-text css-rszk63">Returning to our rsyslog config, we&#x27;ve got the following block at the bottom of the file</p><h1 class="chakra-heading css-1i61012">http logs</h1><p class="chakra-text css-rszk63">dyn_stats(name=&quot;http response&quot;)</p><p class="chakra-text css-rszk63">action(type=&quot;mmnormalize&quot; ruleBase=&quot;/etc/rsyslog-http.rb&quot;)</p><p class="chakra-text css-rszk63">if $!event.tags contains &quot;http&quot; then { set $foo = dyn_inc(&quot;http response&quot;, $!status) }</p><p class="chakra-text css-rszk63">Here we configure a new bucket named &quot;http response&quot;. Every log line that comes through
is matched to an mmnormalize rulebase that tries to parse the log as an HTTP access log.
If the line matches, we pull out some fields - status code, request url, response time
etc. - and tag the log as &quot;http&quot;. We use that tag decide whether we have an http log and
increment the counter for the status code. The rulebase contains 4 lines that look like
this:</p><p class="chakra-text css-rszk63">rule=http:%remote_addr:word% %ident:word% %auth:word% <!-- -->[%timestamp:char-to:]<!-- -->%]
&quot;%method:word% %request:word% HTTP/%httpversion:float%&quot; %status:number%
%bytes_sent:number% &quot;%referrer:char-to:&quot;%&quot; &quot;%agent:char-to:&quot;%&quot;</p><p class="chakra-text css-rszk63">These rules set up a tag (http) and a pattern to match. We set up 4 rules to account for
extra data at the end of the log line, and leading spaces.</p><p class="chakra-text css-rszk63">The docker-compose project includes an nginx container that is configured to send logs
to rsyslog. I&#x27;ve added some dummy endpoints to the configuration so that we can use curl
to generate some web logs:</p><ul><li>/200 returns a 200 OK</li><li>/300 returns a 301 Moved Permanently to /200</li><li>/400 returns a 404 Not Found</li><li>/500 returns a 500 Internal Server Error.</li></ul><p class="chakra-text css-rszk63">Curling these endpoints and waiting a few seconds, we should see some new metrics arrive
in Riemann:</p><p class="chakra-text css-rszk63">riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - http responses/200 = 3
riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - http responses/302 = 1
riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - http responses/404 = 1</p><p class="chakra-text css-rszk63">The code is still rough around the edges, but hopefully you can see how omriemann can
make it easier to monitor applications given only their log files. Next time I want to
talk about a third way to use omriemann: custom metrics in json.</p></div><style data-emotion="css bupnvw">.css-bupnvw{-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;background:#F8F8F8;bottom:0px;left:0px;width:100%;position:fixed;}</style><footer role="contentinfo" class="css-bupnvw"><style data-emotion="css 18ci58h">.css-18ci58h{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:var(--chakra-sizes-8xl);width:100%;margin:auto;}</style><div class="css-18ci58h"></div></footer><span></span></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"var m=Object.defineProperty,c=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var a=Object.getOwnPropertySymbols;var s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var l=(e,t,o)=\u003et in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,n=(e,t)=\u003e{for(var o in t||(t={}))s.call(t,o)\u0026\u0026l(e,o,t[o]);if(a)for(var o of a(t))i.call(t,o)\u0026\u0026l(e,o,t[o]);return e},p=(e,t)=\u003ec(e,h(t));var u=(e,t)=\u003e{var o={};for(var r in e)s.call(e,r)\u0026\u0026t.indexOf(r)\u003c0\u0026\u0026(o[r]=e[r]);if(e!=null\u0026\u0026a)for(var r of a(e))t.indexOf(r)\u003c0\u0026\u0026i.call(e,r)\u0026\u0026(o[r]=e[r]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var r=o,{components:e}=r,t=u(r,[\"components\"]);return mdx(MDXLayout,p(n(n({},layoutProps),t),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,`It's been a little longer than I expected, but I'm finally back and working on Rsyslog.\nLast time `,\"[http://io.made.com/blog/monitoring-with-riemann-and-rsyslog-part-1/]\",`, we\nlooked at how impstats could be used to generate internal metrics from Rsyslog, and how\nto alert on those metrics in Riemann.`),mdx(\"p\",null,`This time I want to look at how the Dynstats module\n`,\"[http://www.rsyslog.com/doc/master/configuration/dyn_stats.html]\",` in Riemann can be used\nto do more interesting monitoring of our applications.`),mdx(\"p\",null,`The Dynstats module provides a simple interface for counting events in Rsyslog. Any time\nwe see a particular pattern in our logs, or we receive a log file from a particular\napplication, we can increment a counter.`),mdx(\"p\",null,`For our first use-case, we're going to use this to record error counts for each of our\napplications. This is one of the simplest and most important metrics that you can\ncapture since most production issues will cause an increase in error rate. When the\n\"Error Rate \u003e Threshold\" alarm goes off, it could be a bad deploy, a misconfigured app,\na bug in your code, or a failing disk on the database server. While you definitely want\nmore granular metrics to help you diagnose problems, this broad approach is fantastic as\nan early warning system.`),mdx(\"p\",null,`For this post, I've put together a docker-compose playground\n`,\"[https://github.com/bobthemighty/rek-stack-demos]\",`. If you want to play along, you'll\nneed a recent version of Docker Compose. Check out the code, and take a look in the\ndynstats/dummy directory.`),mdx(\"p\",null,`To demonstrate a error counter, I've written a quick and dirty Go program that randomly\noutputs either a notice or error level log at regular intervals. We can set the\ninterval, log tag, and error percentage on the command line.`),mdx(\"p\",null,\"docker-compose run dummy -interval 100 -tag foo\"),mdx(\"p\",null,`We can use the dynstats functionality in Rsyslog to count the number of errors that\nhappen in a 10-second window, and send the counter over to Riemann.`),mdx(\"h1\",null,\"We use the dyn_stats function to create a new metrics bucket.\"),mdx(\"h1\",null,\"Each bucket can contain many counters.\"),mdx(\"p\",null,'dyn_stats(name=\"error_rate\")'),mdx(\"h1\",null,'When we receive an \"error\" log, we will add 1 to the counter'),mdx(\"h1\",null,\"for the application that raised the error. We use the $programname\"),mdx(\"h1\",null,\"parsed from the Syslog tag to identify the application.\"),mdx(\"p\",null,`if\n($syslogseverity-text == \"error\") then { set $foo = dyn_inc(\"error_rate\",\n$programname);\n}`),mdx(\"h1\",null,\"Lastly, here's our stats processing.\"),mdx(\"h1\",null,\"Parse the JSON that impstats forwards to us and spit it straight out to Riemann\"),mdx(\"p\",null,`ruleset(name=\"stats\") { action(name=\"parse-stats\" type=\"mmjsonparse\")\naction(name=\"send-to-riemann\" type=\"omriemann\" subtree=\"!\" server=\"riemann\") }`),mdx(\"p\",null,`We can bring this up by running docker-compose up from the root of the demo project.\nAfter everything has started up, you should start to see regular metrics counting the\nnumber of errors.`),mdx(\"p\",null,\"riemann_1 | INFO \",\"[2017-05-29 09:26:11,285]\",` defaultEventExecutorGroup-2-1 -\nriemann.config - error rate/dummy-logger = 9 riemann_1 | INFO `,\"[2017-05-29 09:26:21,259]\",`\ndefaultEventExecutorGroup-2-1 - riemann.config - error rate/dummy-logger = 16`),mdx(\"p\",null,`We can extend our Riemann config so that we raise an error if a metric is above an\nabsolute threshold. Open the file riemann/riemann.config . We're going to edit the\nconfig to add a new rule: when the error_rate is \u003e 10, log an error. In practice, we\nwould want to send an alert to an operator via email, Slack, or PagerDuty. Add the\nfollowing line below the prn on line 13:`),mdx(\"div\",n({},{className:\"remark-highlight\"}),mdx(\"pre\",n({parentName:\"div\"},{className:\"language-unknown\"}),mdx(\"code\",n({parentName:\"pre\"},{className:\"language-unknown\"}),\"    (where (\u0026lt; 10 metric) #(error \u0026quot;Alert! error rate is now \u0026quot; (:metric %)))\"))),mdx(\"p\",null,`Restart everything with docker-compose restart and wait a few seconds. You should start\nto see output like this:`),mdx(\"p\",null,`riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - error\nrate/dummy-logger = 9 riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config -\nerror rate/dummy-logger = 15 riemann_1 | ERROR - Alert! error rate is now 15`),mdx(\"p\",null,`For our second use case, we're going to look at how dynstats and riemann can give us\nsome monitoring of web applications. One of the strong points of rsyslog is its ability\nto rapidly parse large amounts of log text and pull out meaningful fields. Rsyslog can\nparse logs fast enough that we can use it for realtime monitoring of applications. Using\nmmnormalize, dynstats, and omriemann we can monitor our web applications in\nnear-realtime and see a breakdown of HTTP status codes.`),mdx(\"p\",null,\"Returning to our rsyslog config, we've got the following block at the bottom of the file\"),mdx(\"h1\",null,\"http logs\"),mdx(\"p\",null,'dyn_stats(name=\"http response\")'),mdx(\"p\",null,'action(type=\"mmnormalize\" ruleBase=\"/etc/rsyslog-http.rb\")'),mdx(\"p\",null,'if $!event.tags contains \"http\" then { set $foo = dyn_inc(\"http response\", $!status) }'),mdx(\"p\",null,`Here we configure a new bucket named \"http response\". Every log line that comes through\nis matched to an mmnormalize rulebase that tries to parse the log as an HTTP access log.\nIf the line matches, we pull out some fields - status code, request url, response time\netc. - and tag the log as \"http\". We use that tag decide whether we have an http log and\nincrement the counter for the status code. The rulebase contains 4 lines that look like\nthis:`),mdx(\"p\",null,\"rule=http:%remote_addr:word% %ident:word% %auth:word% \",\"[%timestamp:char-to:]\",`%]\n\"%method:word% %request:word% HTTP/%httpversion:float%\" %status:number%\n%bytes_sent:number% \"%referrer:char-to:\"%\" \"%agent:char-to:\"%\"`),mdx(\"p\",null,`These rules set up a tag (http) and a pattern to match. We set up 4 rules to account for\nextra data at the end of the log line, and leading spaces.`),mdx(\"p\",null,`The docker-compose project includes an nginx container that is configured to send logs\nto rsyslog. I've added some dummy endpoints to the configuration so that we can use curl\nto generate some web logs:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"/200 returns a 200 OK\"),mdx(\"li\",{parentName:\"ul\"},\"/300 returns a 301 Moved Permanently to /200\"),mdx(\"li\",{parentName:\"ul\"},\"/400 returns a 404 Not Found\"),mdx(\"li\",{parentName:\"ul\"},\"/500 returns a 500 Internal Server Error.\")),mdx(\"p\",null,`Curling these endpoints and waiting a few seconds, we should see some new metrics arrive\nin Riemann:`),mdx(\"p\",null,`riemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - http responses/200 = 3\nriemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - http responses/302 = 1\nriemann_1 | INFO defaultEventExecutorGroup-2-1 - riemann.config - http responses/404 = 1`),mdx(\"p\",null,`The code is still rough around the edges, but hopefully you can see how omriemann can\nmake it easier to monitor applications given only their log files. Next time I want to\ntalk about a third way to use omriemann: custom metrics in json.`))}MDXContent.isMDXComponent=!0;\n","scope":{}},"date":"2017-05-29","title":"Monitoring with Riemann and rsyslog part 2","layout":"post","author":"Bob","tags":["riemann","monitoring","elk"]},"__N_SSG":true},"page":"/[slug]","query":{"slug":"2017-05-29-monitoring-with-riemann-and-rsyslog-part-2"},"buildId":"ZySGEpxrfAgPLUApbPe4o","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>