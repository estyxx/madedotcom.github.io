<!DOCTYPE html><html><head><link rel="icon" href="https://media.made.com/mws-assets/images/favicon.1.ico"/><link media="screen,handheld" type="text/css" rel="stylesheet" href="https://media.made.com/mws-assets/fontBase_b900f8d534cc10f95604.css"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Introducing the command handler</title><meta name="next-head-count" content="3"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-24780b5468e42e63.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-a56127814584ab09.js" defer=""></script><script src="/_next/static/chunks/pages/_app-063d0cdbbc8e6a9c.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-88f3a092f15cc647.js" defer=""></script><script src="/_next/static/raNWymQ2sbqOLS7OjHD3m/_buildManifest.js" defer=""></script><script src="/_next/static/raNWymQ2sbqOLS7OjHD3m/_ssgManifest.js" defer=""></script><script src="/_next/static/raNWymQ2sbqOLS7OjHD3m/_middlewareManifest.js" defer=""></script></head><body><script>(function setScript(initialValue) {
  var mql = window.matchMedia("(prefers-color-scheme: dark)");
  var systemPreference = mql.matches ? "dark" : "light";
  var persistedPreference = systemPreference;

  try {
    persistedPreference = localStorage.getItem("chakra-ui-color-mode");
  } catch (error) {
    console.log("Chakra UI: localStorage is not available. Color mode persistence might not work as expected");
  }

  var colorMode;

  if (persistedPreference) {
    colorMode = persistedPreference;
  } else if (initialValue === "system") {
    colorMode = systemPreference;
  } else {
    colorMode = initialValue != null ? initialValue : systemPreference;
  }

  if (colorMode) {
    /**
     * Keep in sync with `root.set() {@file ./color-mode.utils.ts}
     */
    document.documentElement.style.setProperty("--chakra-ui-color-mode", colorMode);
    document.documentElement.setAttribute("data-theme", colorMode);
  }
})('light')</script><div id="__next" data-reactroot=""><style data-emotion="css-global 1co9hnp">:host,:root{--chakra-ring-inset:var(--chakra-empty,/*!*/ /*!*/);--chakra-ring-offset-width:0px;--chakra-ring-offset-color:#fff;--chakra-ring-color:rgba(66, 153, 225, 0.6);--chakra-ring-offset-shadow:0 0 #0000;--chakra-ring-shadow:0 0 #0000;--chakra-space-x-reverse:0;--chakra-space-y-reverse:0;--chakra-colors-transparent:transparent;--chakra-colors-current:currentColor;--chakra-colors-black:#000000;--chakra-colors-white:#FFFFFF;--chakra-colors-whiteAlpha-50:rgba(255, 255, 255, 0.04);--chakra-colors-whiteAlpha-100:rgba(255, 255, 255, 0.06);--chakra-colors-whiteAlpha-200:rgba(255, 255, 255, 0.08);--chakra-colors-whiteAlpha-300:rgba(255, 255, 255, 0.16);--chakra-colors-whiteAlpha-400:rgba(255, 255, 255, 0.24);--chakra-colors-whiteAlpha-500:rgba(255, 255, 255, 0.36);--chakra-colors-whiteAlpha-600:rgba(255, 255, 255, 0.48);--chakra-colors-whiteAlpha-700:rgba(255, 255, 255, 0.64);--chakra-colors-whiteAlpha-800:rgba(255, 255, 255, 0.80);--chakra-colors-whiteAlpha-900:rgba(255, 255, 255, 0.92);--chakra-colors-blackAlpha-50:rgba(0, 0, 0, 0.04);--chakra-colors-blackAlpha-100:rgba(0, 0, 0, 0.06);--chakra-colors-blackAlpha-200:rgba(0, 0, 0, 0.08);--chakra-colors-blackAlpha-300:rgba(0, 0, 0, 0.16);--chakra-colors-blackAlpha-400:rgba(0, 0, 0, 0.24);--chakra-colors-blackAlpha-500:rgba(0, 0, 0, 0.36);--chakra-colors-blackAlpha-600:rgba(0, 0, 0, 0.48);--chakra-colors-blackAlpha-700:rgba(0, 0, 0, 0.64);--chakra-colors-blackAlpha-800:rgba(0, 0, 0, 0.80);--chakra-colors-blackAlpha-900:rgba(0, 0, 0, 0.92);--chakra-colors-gray-50:#F7FAFC;--chakra-colors-gray-100:#EDF2F7;--chakra-colors-gray-200:#E2E8F0;--chakra-colors-gray-300:#CBD5E0;--chakra-colors-gray-400:#A0AEC0;--chakra-colors-gray-500:#718096;--chakra-colors-gray-600:#4A5568;--chakra-colors-gray-700:#2D3748;--chakra-colors-gray-800:#1A202C;--chakra-colors-gray-900:#171923;--chakra-colors-red-5:#fff2f0;--chakra-colors-red-10:#ffdfdd;--chakra-colors-red-50:#F15856;--chakra-colors-red-80:#d03740;--chakra-colors-red-100:#FED7D7;--chakra-colors-red-200:#FEB2B2;--chakra-colors-red-300:#FC8181;--chakra-colors-red-400:#F56565;--chakra-colors-red-500:#E53E3E;--chakra-colors-red-600:#C53030;--chakra-colors-red-700:#9B2C2C;--chakra-colors-red-800:#822727;--chakra-colors-red-900:#63171B;--chakra-colors-orange-50:#FFFAF0;--chakra-colors-orange-100:#FEEBC8;--chakra-colors-orange-200:#FBD38D;--chakra-colors-orange-300:#F6AD55;--chakra-colors-orange-400:#ED8936;--chakra-colors-orange-500:#DD6B20;--chakra-colors-orange-600:#C05621;--chakra-colors-orange-700:#9C4221;--chakra-colors-orange-800:#7B341E;--chakra-colors-orange-900:#652B19;--chakra-colors-yellow-50:#FFFFF0;--chakra-colors-yellow-100:#FEFCBF;--chakra-colors-yellow-200:#FAF089;--chakra-colors-yellow-300:#F6E05E;--chakra-colors-yellow-400:#ECC94B;--chakra-colors-yellow-500:#D69E2E;--chakra-colors-yellow-600:#B7791F;--chakra-colors-yellow-700:#975A16;--chakra-colors-yellow-800:#744210;--chakra-colors-yellow-900:#5F370E;--chakra-colors-green-5:#e4fbe5;--chakra-colors-green-10:#ccf5ce;--chakra-colors-green-50:#30a75b;--chakra-colors-green-80:#008248;--chakra-colors-green-100:#C6F6D5;--chakra-colors-green-200:#9AE6B4;--chakra-colors-green-300:#68D391;--chakra-colors-green-400:#48BB78;--chakra-colors-green-500:#38A169;--chakra-colors-green-600:#2F855A;--chakra-colors-green-700:#276749;--chakra-colors-green-800:#22543D;--chakra-colors-green-900:#1C4532;--chakra-colors-teal-50:#E6FFFA;--chakra-colors-teal-100:#B2F5EA;--chakra-colors-teal-200:#81E6D9;--chakra-colors-teal-300:#4FD1C5;--chakra-colors-teal-400:#38B2AC;--chakra-colors-teal-500:#319795;--chakra-colors-teal-600:#2C7A7B;--chakra-colors-teal-700:#285E61;--chakra-colors-teal-800:#234E52;--chakra-colors-teal-900:#1D4044;--chakra-colors-blue-50:#ebf8ff;--chakra-colors-blue-100:#bee3f8;--chakra-colors-blue-200:#90cdf4;--chakra-colors-blue-300:#63b3ed;--chakra-colors-blue-400:#4299e1;--chakra-colors-blue-500:#3182ce;--chakra-colors-blue-600:#2b6cb0;--chakra-colors-blue-700:#2c5282;--chakra-colors-blue-800:#2a4365;--chakra-colors-blue-900:#1A365D;--chakra-colors-cyan-50:#EDFDFD;--chakra-colors-cyan-100:#C4F1F9;--chakra-colors-cyan-200:#9DECF9;--chakra-colors-cyan-300:#76E4F7;--chakra-colors-cyan-400:#0BC5EA;--chakra-colors-cyan-500:#00B5D8;--chakra-colors-cyan-600:#00A3C4;--chakra-colors-cyan-700:#0987A0;--chakra-colors-cyan-800:#086F83;--chakra-colors-cyan-900:#065666;--chakra-colors-purple-50:#FAF5FF;--chakra-colors-purple-100:#E9D8FD;--chakra-colors-purple-200:#D6BCFA;--chakra-colors-purple-300:#B794F4;--chakra-colors-purple-400:#9F7AEA;--chakra-colors-purple-500:#805AD5;--chakra-colors-purple-600:#6B46C1;--chakra-colors-purple-700:#553C9A;--chakra-colors-purple-800:#44337A;--chakra-colors-purple-900:#322659;--chakra-colors-pink-50:#FFF5F7;--chakra-colors-pink-100:#FED7E2;--chakra-colors-pink-200:#FBB6CE;--chakra-colors-pink-300:#F687B3;--chakra-colors-pink-400:#ED64A6;--chakra-colors-pink-500:#D53F8C;--chakra-colors-pink-600:#B83280;--chakra-colors-pink-700:#97266D;--chakra-colors-pink-800:#702459;--chakra-colors-pink-900:#521B41;--chakra-colors-linkedin-50:#E8F4F9;--chakra-colors-linkedin-100:#CFEDFB;--chakra-colors-linkedin-200:#9BDAF3;--chakra-colors-linkedin-300:#68C7EC;--chakra-colors-linkedin-400:#34B3E4;--chakra-colors-linkedin-500:#00A0DC;--chakra-colors-linkedin-600:#008CC9;--chakra-colors-linkedin-700:#0077B5;--chakra-colors-linkedin-800:#005E93;--chakra-colors-linkedin-900:#004471;--chakra-colors-facebook-50:#E8F4F9;--chakra-colors-facebook-100:#D9DEE9;--chakra-colors-facebook-200:#B7C2DA;--chakra-colors-facebook-300:#6482C0;--chakra-colors-facebook-400:#4267B2;--chakra-colors-facebook-500:#385898;--chakra-colors-facebook-600:#314E89;--chakra-colors-facebook-700:#29487D;--chakra-colors-facebook-800:#223B67;--chakra-colors-facebook-900:#1E355B;--chakra-colors-messenger-50:#D0E6FF;--chakra-colors-messenger-100:#B9DAFF;--chakra-colors-messenger-200:#A2CDFF;--chakra-colors-messenger-300:#7AB8FF;--chakra-colors-messenger-400:#2E90FF;--chakra-colors-messenger-500:#0078FF;--chakra-colors-messenger-600:#0063D1;--chakra-colors-messenger-700:#0052AC;--chakra-colors-messenger-800:#003C7E;--chakra-colors-messenger-900:#002C5C;--chakra-colors-whatsapp-50:#dffeec;--chakra-colors-whatsapp-100:#b9f5d0;--chakra-colors-whatsapp-200:#90edb3;--chakra-colors-whatsapp-300:#65e495;--chakra-colors-whatsapp-400:#3cdd78;--chakra-colors-whatsapp-500:#22c35e;--chakra-colors-whatsapp-600:#179848;--chakra-colors-whatsapp-700:#0c6c33;--chakra-colors-whatsapp-800:#01421c;--chakra-colors-whatsapp-900:#001803;--chakra-colors-twitter-50:#E5F4FD;--chakra-colors-twitter-100:#C8E9FB;--chakra-colors-twitter-200:#A8DCFA;--chakra-colors-twitter-300:#83CDF7;--chakra-colors-twitter-400:#57BBF5;--chakra-colors-twitter-500:#1DA1F2;--chakra-colors-twitter-600:#1A94DA;--chakra-colors-twitter-700:#1681BF;--chakra-colors-twitter-800:#136B9E;--chakra-colors-twitter-900:#0D4D71;--chakra-colors-telegram-50:#E3F2F9;--chakra-colors-telegram-100:#C5E4F3;--chakra-colors-telegram-200:#A2D4EC;--chakra-colors-telegram-300:#7AC1E4;--chakra-colors-telegram-400:#47A9DA;--chakra-colors-telegram-500:#0088CC;--chakra-colors-telegram-600:#007AB8;--chakra-colors-telegram-700:#006BA1;--chakra-colors-telegram-800:#005885;--chakra-colors-telegram-900:#003F5E;--chakra-colors-made-5:#fafafa;--chakra-colors-made-10:#f5f6f4;--chakra-colors-made-20:#eef0ed;--chakra-colors-made-30:#e1e3de;--chakra-colors-made-40:#bdbfbb;--chakra-colors-made-50:#9fa19d;--chakra-colors-made-60:#767874;--chakra-colors-made-70:#626360;--chakra-colors-made-80:#434442;--chakra-colors-made-90:#222321;--chakra-colors-made-black:#131413;--chakra-colors-made-baige:#d9c3b8;--chakra-colors-made-green:#c0d0cf;--chakra-colors-made-grey:#d7d3d0;--chakra-colors-made-blue:#353F7D;--chakra-borders-none:0;--chakra-borders-1px:1px solid;--chakra-borders-2px:2px solid;--chakra-borders-4px:4px solid;--chakra-borders-8px:8px solid;--chakra-fonts-heading:FS Neruda;--chakra-fonts-body:FS Meridian Regular,sans-serif;--chakra-fonts-mono:FS Hack;--chakra-fontSizes-xs:0.75rem;--chakra-fontSizes-sm:0.875rem;--chakra-fontSizes-md:1rem;--chakra-fontSizes-lg:1.125rem;--chakra-fontSizes-xl:1.25rem;--chakra-fontSizes-2xl:1.5rem;--chakra-fontSizes-3xl:1.875rem;--chakra-fontSizes-4xl:2.25rem;--chakra-fontSizes-5xl:3rem;--chakra-fontSizes-6xl:3.75rem;--chakra-fontSizes-7xl:4.5rem;--chakra-fontSizes-8xl:6rem;--chakra-fontSizes-9xl:8rem;--chakra-fontWeights-hairline:100;--chakra-fontWeights-thin:200;--chakra-fontWeights-light:300;--chakra-fontWeights-normal:400;--chakra-fontWeights-medium:500;--chakra-fontWeights-semibold:600;--chakra-fontWeights-bold:700;--chakra-fontWeights-extrabold:800;--chakra-fontWeights-black:900;--chakra-letterSpacings-tighter:-0.05em;--chakra-letterSpacings-tight:-0.025em;--chakra-letterSpacings-normal:0;--chakra-letterSpacings-wide:0.025em;--chakra-letterSpacings-wider:0.05em;--chakra-letterSpacings-widest:0.1em;--chakra-lineHeights-3:.75rem;--chakra-lineHeights-4:1rem;--chakra-lineHeights-5:1.25rem;--chakra-lineHeights-6:1.5rem;--chakra-lineHeights-7:1.75rem;--chakra-lineHeights-8:2rem;--chakra-lineHeights-9:2.25rem;--chakra-lineHeights-10:2.5rem;--chakra-lineHeights-normal:normal;--chakra-lineHeights-none:1;--chakra-lineHeights-shorter:1.25;--chakra-lineHeights-short:1.375;--chakra-lineHeights-base:1.5;--chakra-lineHeights-tall:1.625;--chakra-lineHeights-taller:2;--chakra-radii-none:0;--chakra-radii-sm:0.125rem;--chakra-radii-base:0.25rem;--chakra-radii-md:0.375rem;--chakra-radii-lg:0.5rem;--chakra-radii-xl:0.75rem;--chakra-radii-2xl:1rem;--chakra-radii-3xl:1.5rem;--chakra-radii-full:9999px;--chakra-space-1:0.25rem;--chakra-space-2:0.5rem;--chakra-space-3:0.75rem;--chakra-space-4:1rem;--chakra-space-5:1.25rem;--chakra-space-6:1.5rem;--chakra-space-7:1.75rem;--chakra-space-8:2rem;--chakra-space-9:2.25rem;--chakra-space-10:2.5rem;--chakra-space-12:3rem;--chakra-space-14:3.5rem;--chakra-space-16:4rem;--chakra-space-20:5rem;--chakra-space-24:6rem;--chakra-space-28:7rem;--chakra-space-32:8rem;--chakra-space-36:9rem;--chakra-space-40:10rem;--chakra-space-44:11rem;--chakra-space-48:12rem;--chakra-space-52:13rem;--chakra-space-56:14rem;--chakra-space-60:15rem;--chakra-space-64:16rem;--chakra-space-72:18rem;--chakra-space-80:20rem;--chakra-space-96:24rem;--chakra-space-px:1px;--chakra-space-0-5:0.125rem;--chakra-space-1-5:0.375rem;--chakra-space-2-5:0.625rem;--chakra-space-3-5:0.875rem;--chakra-shadows-xs:0 0 0 1px rgba(0, 0, 0, 0.05);--chakra-shadows-sm:0 1px 2px 0 rgba(0, 0, 0, 0.05);--chakra-shadows-base:0 1px 3px 0 rgba(0, 0, 0, 0.1),0 1px 2px 0 rgba(0, 0, 0, 0.06);--chakra-shadows-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--chakra-shadows-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);--chakra-shadows-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1),0 10px 10px -5px rgba(0, 0, 0, 0.04);--chakra-shadows-2xl:0 25px 50px -12px rgba(0, 0, 0, 0.25);--chakra-shadows-outline:0 0 0 3px rgba(66, 153, 225, 0.6);--chakra-shadows-inner:inset 0 2px 4px 0 rgba(0,0,0,0.06);--chakra-shadows-none:none;--chakra-shadows-dark-lg:rgba(0, 0, 0, 0.1) 0px 0px 0px 1px,rgba(0, 0, 0, 0.2) 0px 5px 10px,rgba(0, 0, 0, 0.4) 0px 15px 40px;--chakra-sizes-1:0.25rem;--chakra-sizes-2:0.5rem;--chakra-sizes-3:0.75rem;--chakra-sizes-4:1rem;--chakra-sizes-5:1.25rem;--chakra-sizes-6:1.5rem;--chakra-sizes-7:1.75rem;--chakra-sizes-8:2rem;--chakra-sizes-9:2.25rem;--chakra-sizes-10:2.5rem;--chakra-sizes-12:3rem;--chakra-sizes-14:3.5rem;--chakra-sizes-16:4rem;--chakra-sizes-20:5rem;--chakra-sizes-24:6rem;--chakra-sizes-28:7rem;--chakra-sizes-32:8rem;--chakra-sizes-36:9rem;--chakra-sizes-40:10rem;--chakra-sizes-44:11rem;--chakra-sizes-48:12rem;--chakra-sizes-52:13rem;--chakra-sizes-56:14rem;--chakra-sizes-60:15rem;--chakra-sizes-64:16rem;--chakra-sizes-72:18rem;--chakra-sizes-80:20rem;--chakra-sizes-96:24rem;--chakra-sizes-px:1px;--chakra-sizes-0-5:0.125rem;--chakra-sizes-1-5:0.375rem;--chakra-sizes-2-5:0.625rem;--chakra-sizes-3-5:0.875rem;--chakra-sizes-max:max-content;--chakra-sizes-min:min-content;--chakra-sizes-full:100%;--chakra-sizes-3xs:14rem;--chakra-sizes-2xs:16rem;--chakra-sizes-xs:20rem;--chakra-sizes-sm:24rem;--chakra-sizes-md:28rem;--chakra-sizes-lg:32rem;--chakra-sizes-xl:36rem;--chakra-sizes-2xl:42rem;--chakra-sizes-3xl:48rem;--chakra-sizes-4xl:56rem;--chakra-sizes-5xl:64rem;--chakra-sizes-6xl:72rem;--chakra-sizes-7xl:80rem;--chakra-sizes-8xl:90rem;--chakra-sizes-container-sm:640px;--chakra-sizes-container-md:768px;--chakra-sizes-container-lg:1024px;--chakra-sizes-container-xl:1280px;--chakra-zIndices-hide:-1;--chakra-zIndices-auto:auto;--chakra-zIndices-base:0;--chakra-zIndices-docked:10;--chakra-zIndices-dropdown:1000;--chakra-zIndices-sticky:1100;--chakra-zIndices-banner:1200;--chakra-zIndices-overlay:1300;--chakra-zIndices-modal:1400;--chakra-zIndices-popover:1500;--chakra-zIndices-skipLink:1600;--chakra-zIndices-toast:1700;--chakra-zIndices-tooltip:1800;--chakra-transition-property-common:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform;--chakra-transition-property-colors:background-color,border-color,color,fill,stroke;--chakra-transition-property-dimensions:width,height;--chakra-transition-property-position:left,right,top,bottom;--chakra-transition-property-background:background-color,background-image,background-position;--chakra-transition-easing-ease-in:cubic-bezier(0.4, 0, 1, 1);--chakra-transition-easing-ease-out:cubic-bezier(0, 0, 0.2, 1);--chakra-transition-easing-ease-in-out:cubic-bezier(0.4, 0, 0.2, 1);--chakra-transition-duration-ultra-fast:50ms;--chakra-transition-duration-faster:100ms;--chakra-transition-duration-fast:150ms;--chakra-transition-duration-normal:200ms;--chakra-transition-duration-slow:300ms;--chakra-transition-duration-slower:400ms;--chakra-transition-duration-ultra-slow:500ms;--chakra-blur-none:0;--chakra-blur-sm:4px;--chakra-blur-base:8px;--chakra-blur-md:12px;--chakra-blur-lg:16px;--chakra-blur-xl:24px;--chakra-blur-2xl:40px;--chakra-blur-3xl:64px;}</style><style data-emotion="css-global 1jqlf9g">html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale;touch-action:manipulation;}body{position:relative;min-height:100%;font-feature-settings:'kern';}*,*::before,*::after{border-width:0;border-style:solid;box-sizing:border-box;}main{display:block;}hr{border-top-width:1px;box-sizing:content-box;height:0;overflow:visible;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:1em;}a{background-color:transparent;color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bold;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none!important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none!important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}template{display:none;}[hidden]{display:none!important;}body,blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0!important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}img,svg,video,canvas,audio,iframe,embed,object{display:block;}img,video{max-width:100%;height:auto;}[data-js-focus-visible] :focus:not([data-focus-visible-added]){outline:none;box-shadow:none;}select::-ms-expand{display:none;}</style><style data-emotion="css-global 1baqkrf">body{font-family:var(--chakra-fonts-body);color:var(--chakra-colors-gray-800);background:var(--chakra-colors-white);transition-property:background-color;transition-duration:var(--chakra-transition-duration-normal);line-height:var(--chakra-lineHeights-base);}*::-webkit-input-placeholder{color:var(--chakra-colors-gray-400);}*::-moz-placeholder{color:var(--chakra-colors-gray-400);}*:-ms-input-placeholder{color:var(--chakra-colors-gray-400);}*::placeholder{color:var(--chakra-colors-gray-400);}*,*::before,::after{border-color:var(--chakra-colors-gray-200);word-wrap:break-word;}</style><style data-emotion="css mfxtb">.css-mfxtb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;box-shadow:var(--chakra-shadows-base);width:100%;margin-bottom:var(--chakra-space-8);padding:var(--chakra-space-8);}</style><header class="css-mfxtb"><style data-emotion="css 18ci58h">.css-18ci58h{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:var(--chakra-sizes-8xl);width:100%;margin:auto;}</style><div class="css-18ci58h"><div class="css-0"><a href="/"><img alt="Logo" src="https://media.made.com/mws-assets/images/MadeLogo.2.svg" class="chakra-image css-0" aria-label="Logo"/></a></div><style data-emotion="css 1wsmmqi">@media screen and (min-width: 30em){.css-1wsmmqi{display:block;}}@media screen and (min-width: 48em){.css-1wsmmqi{display:none;}}</style><div class="css-1wsmmqi"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div><style data-emotion="css 3txhs">.css-3txhs{display:none;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;margin-left:auto;}@media screen and (min-width: 48em){.css-3txhs{display:block;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;}}</style><div class="css-3txhs"><style data-emotion="css 1lpw2d">.css-1lpw2d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding-top:var(--chakra-space-4);}.css-1lpw2d>*:not(style)~*:not(style){margin-top:var(--chakra-space-8);-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:0px;margin-inline-start:0px;}@media screen and (min-width: 30em){.css-1lpw2d{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding-top:var(--chakra-space-4);}.css-1lpw2d>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:var(--chakra-space-8);margin-inline-start:var(--chakra-space-8);}}@media screen and (min-width: 48em){.css-1lpw2d{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding-top:0px;}.css-1lpw2d>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:var(--chakra-space-8);margin-inline-start:var(--chakra-space-8);}}@media screen and (min-width: 62em){.css-1lpw2d{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding-top:0px;}.css-1lpw2d>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:var(--chakra-space-8);margin-inline-start:var(--chakra-space-8);}}</style><div class="chakra-stack css-1lpw2d"><style data-emotion="css f4h6uy">.css-f4h6uy{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:inherit;}.css-f4h6uy:hover,.css-f4h6uy[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-f4h6uy:focus,.css-f4h6uy[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a target="" class="chakra-link css-f4h6uy" href="/"><style data-emotion="css 1twuvi0">.css-1twuvi0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;width:100%;}.css-1twuvi0>*:not(style)~*:not(style){margin-top:0px;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:0.5rem;margin-inline-start:0.5rem;}</style><div class="chakra-stack css-1twuvi0"><p class="chakra-text css-0">Home</p></div></a><a target="_blank" class="chakra-link css-f4h6uy" href="https://www.made.com/careers"><div class="chakra-stack css-1twuvi0"><p class="chakra-text css-0">Careers</p><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></div></a></div></div></div></header><style data-emotion="css rkbxzj">.css-rkbxzj{width:100%;-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;max-width:var(--chakra-sizes-4xl);-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem;}</style><div class="chakra-container css-rkbxzj"><style data-emotion="css 1xr7jem">.css-1xr7jem{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-5xl);line-height:1;margin-bottom:var(--chakra-space-6);}@media screen and (min-width: 48em){.css-1xr7jem{font-size:var(--chakra-fontSizes-6xl);}}</style><h1 class="chakra-heading css-1xr7jem">Introducing the command handler</h1><style data-emotion="css 1iv087f">.css-1iv087f{margin-bottom:var(--chakra-space-2);font-weight:var(--chakra-fontWeights-bold);}</style><p class="chakra-text css-1iv087f">by <!-- -->Bob</p><style data-emotion="css b64cj9">.css-b64cj9{margin-bottom:var(--chakra-space-4);color:var(--chakra-colors-made-50);}</style><p class="chakra-text css-b64cj9">Thu Sep 07 2017</p><style data-emotion="css rszk63">.css-rszk63{margin-bottom:var(--chakra-space-4);}</style><p class="chakra-text css-rszk63">The term DDD comes from the book by Eric Evans:
&quot;<style data-emotion="css 1ud5qxa">.css-1ud5qxa{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;-webkit-text-decoration:none;text-decoration:none;outline:2px solid transparent;outline-offset:2px;color:var(--chakra-colors-made-blue);}.css-1ud5qxa:hover,.css-1ud5qxa[data-hover]{-webkit-text-decoration:underline;text-decoration:underline;}.css-1ud5qxa:focus,.css-1ud5qxa[data-focus]{box-shadow:var(--chakra-shadows-outline);}</style><a target="_blank" class="chakra-link css-1ud5qxa" href="https://www.amazon.co.uk/Domain-driven-Design-Tackling-Complexity-Software/dp/0321125215">Domain-Driven Design: Tackling Complexity in the Heart of Software</a>
&quot;. In his book he describes a set of practices that aim to help us build maintainable,
rich, software systems that solve customer&#x27;s problems. The book is 560 pages of dense
insight, so you&#x27;ll pardon me if my summary elides some details, but in brief he
suggests:</p><ul><li>Listen very carefully to your domain experts - the people whose job you&#x27;re automating
or assisting in software.</li><li>Learn the jargon that they use, and help them to come up with new jargon, so that
every concept in their mental model is named by a single precise term.</li><li>Use those terms to model your software; the nouns and verbs of the domain expert are
the classes and methods you should use in modelling.</li><li>Whenever there is a discrepancy between your shared understanding of the domain, go
and talk to the domain experts again, and then refactor aggressively.</li></ul><p class="chakra-text css-rszk63">This sounds great in theory, but in practice we often find that our business logic
escapes from our model objects; we end up with logic bleeding into controllers, or into
fat &quot;manager&quot; classes. We find that refactoring becomes difficult: we can&#x27;t split a
large and important class, because that would seriously impact the database schema; or
we can&#x27;t rewrite the internals of an algorithm because it has become tightly coupled to
code that exists for a different use-case. The good news is that these problems can be
avoided, since they are caused by a lack of organisation in the codebase. In fact, the
tools to solve these problems take up half of the DDD book, but it can be be difficult
to understand how to use them together in the context of a complete system.</p><p class="chakra-text css-rszk63">I want to use this series to introduce an architectural style called
<a target="_blank" class="chakra-link css-1ud5qxa" href="http://wiki.c2.com/?PortsAndAdaptersArchitecture">Ports and Adapters</a>, and a design
pattern named
<a target="_blank" class="chakra-link css-1ud5qxa" href="https://matthiasnoback.nl/2015/01/responsibilities-of-the-command-bus/">Command Handler</a>.
I&#x27;ll be explaining the patterns in Python because that&#x27;s the language that I use
day-to-day, but the concepts are applicable to any OO language, and can be massaged to
work perfectly in a functional context. There might be a lot more layering and
abstraction than you&#x27;re used to, especially if you&#x27;re coming from a Django background or
similar, but please bear with me. In exchange for a more complex system at the outset,
we can avoid much of our
<a target="_blank" class="chakra-link css-1ud5qxa" href="http://wiki.c2.com/?AccidentalComplexity">accidental complexity</a> later.</p><p class="chakra-text css-rszk63">The system we&#x27;re going to build is an issue management system, for use by a helpdesk.
We&#x27;re going to be replacing an existing system, which consists of an HTML form that
sends an email. The emails go into a mailbox, and helpdesk staff go through the mails
triaging problems and picking up problems that they can solve. Sometimes issues get
overlooked for a long time, and the helpdesk team have invented a complex system of
post-it notes and whiteboard layouts to track work in progress. For a while this system
has worked pretty well but, as the system gets busier, the cracks are beginning to show.</p><p class="chakra-text css-rszk63">Our first conversation with the domain expert &quot;What&#x27;s the first step in the process?&quot;
you ask, &quot;How do tickets end up in the mail box?&quot;.</p><p class="chakra-text css-rszk63">&quot;Well, the first thing that happens is the user goes to the web page, and they fill out
some details, and report an issue. That sends an email into the issue log and then we
pick issues from the log each morning&quot;.</p><p class="chakra-text css-rszk63">&quot;So when a user reports an issue, what&#x27;s the minimal set of data that you need from
them?&quot;</p><p class="chakra-text css-rszk63">&quot;We need to know who they are, so their name, and email I guess. Uh... and the problem
description. They&#x27;re supposed to add a category, but they never do, and we used to have
a priority, but everyone set their issue to EXTREMELY URGENT, so it was useless.</p><p class="chakra-text css-rszk63">&quot;But a category and priority would help you to triage things?&quot;</p><p class="chakra-text css-rszk63">&quot;Yes, that would be really helpful if we could get users to set them properly.&quot;</p><p class="chakra-text css-rszk63">This gives us our first use case: As a user, I want to be able to report a new issue.</p><p class="chakra-text css-rszk63">Okay, before we get to the code, let&#x27;s talk about architecture. The architecture of a
software system is the overall structure - the choice of language, technology, and
design patterns that organise the code and satisfy our
<a target="_blank" class="chakra-link css-1ud5qxa" href="https://en.wikipedia.org/wiki/Non-functional_requirement">constraints</a>. For our
architecture, we&#x27;re going to try and stick with three principles:</p><ol><li>We will always define where our use-cases begin and end. We won&#x27;t have business
processes that are strewn all over the codebase.</li><li>We will
<a target="_blank" class="chakra-link css-1ud5qxa" href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">depend on abstractions</a>
, and not on concrete implementations.</li><li>We will treat glue code as distinct from business logic, and put it in an
appropriate place.</li></ol><p class="chakra-text css-rszk63">Firstly we start with the <strong>domain model</strong>. The domain model encapsulates our shared
understanding of the problem, and uses the terms we agreed with the domain experts. In
keeping with principle #2 we will define abstractions for any infrastructural or
technical concerns and use those in our model. For example, if we need to send an email,
or save an entity to a database, we will do so through an abstraction that captures our
intent. In this series we&#x27;ll create a separate python package for our domain model so
that we can be sure it has no dependencies on the other layers of the system.
Maintaining this rule strictly will make it easier to test and refactor our system,
since our domain models aren&#x27;t tangled up with messy details of databases and http
calls.</p><p class="chakra-text css-rszk63">Around the outside of our domain model we place <strong>services</strong>. These are stateless
objects that do stuff to the domain. In particular, for this system, our command
handlers are part of the service layer.</p><p class="chakra-text css-rszk63">Finally, we have our <strong>adapter</strong> layer. This layer contains code that drives the service
layer, or provides services to the domain model. For example, our domain model may have
an abstraction for talking to the database, but the adapter layer provides a concrete
implementation. Other adapters might include a Flask API, or our set of unit tests, or a
celery event queue. All of these adapters connect our application to the outside world.</p><p class="chakra-text css-rszk63">In keeping with our first principle, we&#x27;re going to define a boundary for this use case
and create our first <em>Command Handler</em>. A command handler is an object that orchestrates
a business process. It does the boring work of fetching the right objects, and invoking
the right methods on them. It&#x27;s similar to the concept of a Controller in an MVC
architecture.</p><p class="chakra-text css-rszk63">First, we create a <em>Command</em> object.</p><div class="remark-highlight"><pre class="language-python"><style data-emotion="css e69dqy">.css-e69dqy{position:relative;z-index:0;}</style><div class="css-e69dqy"><style data-emotion="css 13wyh5o">.css-13wyh5o{padding:var(--chakra-space-5);overflow:hidden;background:var(--chakra-colors-orange-50);border-radius:10px;margin-bottom:var(--chakra-space-10);font-size:var(--chakra-fontSizes-sm);box-shadow:var(--chakra-shadows-lg);}</style><div class="css-13wyh5o"><div class="css-0"><span class="token keyword">class</span> <span class="token class-name">ReportIssueCommand</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
        reporter_name<span class="token punctuation">:</span> <span class="token builtin">str</span>
        reporter_email<span class="token punctuation">:</span> <span class="token builtin">str</span>
        problem_description<span class="token punctuation">:</span> <span class="token builtin">str</span>
</div></div></div></pre></div><p class="chakra-text css-rszk63">A command object is a small object that represents a state-changing action that can
happen in the system. Commands have no behaviour, they&#x27;re pure data structures. There&#x27;s
no reason why you have to represent them with classes, since all they need is a name and
a bag of data, but a NamedTuple is a nice compromise between simplicity and convenience.
Commands are instructions from an external agent (a user, a cron job, another service
etc.) and have names in the imperative tense, for example:</p><ul><li>ReportIssue</li><li>PrepareUploadUri</li><li>CancelOutstandingOrders</li><li>RemoveItemFromCart</li><li>OpenLoginSession</li><li>PlaceCustomerOrder</li><li>BeginPaymentProcess</li></ul><p class="chakra-text css-rszk63">We should try to avoid the verbs Create, Update, or Delete (and their synonyms) because
those are technical implementations. When we listen to our domain experts, we often find
that there is a better word for the operation we&#x27;re trying to model. If all of your
commands are named &quot;CreateIssue&quot;, &quot;UpdateCart&quot;, &quot;DeleteOrders&quot;, then you&#x27;re probably not
paying enough attention to the language that your stakeholders are using.</p><p class="chakra-text css-rszk63">The command objects belong to the domain, and they express the API of your domain. If
every state-changing action is performed via a command handler, then the list of
Commands is the complete list of supported operations in your domain model. This has two
major benefits:</p><ol><li>If the only way to change state in the system is through a command, then the list of
commands tells me all the things I need to test. There are no other code paths that
can modify data.</li><li>Because our commands are lightweight, logic-free objects, we can create them from an
HTTP post, or a celery task, or a command line csv reader, or a unit test. They form
a simple and stable API for our system that does not depend on any implementation
details and can be invoked in multiple ways.</li></ol><p class="chakra-text css-rszk63">In order to process our new command, we&#x27;ll need to create a command handler.</p><div class="remark-highlight"><pre class="language-python"><div class="css-e69dqy"><div class="css-13wyh5o"><div class="css-0"><span class="token keyword">class</span> <span class="token class-name">ReportIssueCommandHandler</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> issue_log<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>issue_log <span class="token operator">=</span> issue_log

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
        reported_by <span class="token operator">=</span> IssueReporter<span class="token punctuation">(</span>
            cmd<span class="token punctuation">.</span>reporter_name<span class="token punctuation">,</span>
            cmd<span class="token punctuation">.</span>reporter_email<span class="token punctuation">)</span>
        issue <span class="token operator">=</span> Issue<span class="token punctuation">(</span>reported_by<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span>problem_description<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>issue_log<span class="token punctuation">.</span>add<span class="token punctuation">(</span>issue<span class="token punctuation">)</span>
</div></div></div></pre></div><p class="chakra-text css-rszk63">Command handlers are stateless objects that orchestrate the behaviour of a system. They
are a kind of glue code, and manage the boring work of fetching and saving objects, and
then notifying other parts of the system. In keeping with principle #3, we keep this in
a separate layer. To satisfy principle #1, each use case is a separate command handler
and has a clearly defined beginning and end. Every command is handled by exactly one
command handler.</p><p class="chakra-text css-rszk63">In general all command handlers will have the same structure:</p><ol><li>Fetch the current state from our persistent storage.</li><li>Update the current state.</li><li>Persist the new state.</li><li>Notify any external systems that our state has changed.</li></ol><p class="chakra-text css-rszk63">We will usually avoid if statements, loops, and other such wizardry in our handlers, and
stick to a single possible line of execution. Command handlers are boring glue code.
Since our command handlers are just glue code, we won&#x27;t put any business logic into
them - they shouldn&#x27;t be making any business decisions. For example, let&#x27;s skip ahead a
little to a new command handler:</p><div class="remark-highlight"><pre class="language-python"><div class="css-e69dqy"><div class="css-13wyh5o"><div class="css-0"><span class="token keyword">class</span> <span class="token class-name">MarkIssueAsResolvedHandler</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> issue_log<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>issue_log <span class="token operator">=</span> issue_log

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
        issue <span class="token operator">=</span> self<span class="token punctuation">.</span>issue_log<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>issue_id<span class="token punctuation">)</span>
        <span class="token comment"># the following line encodes a business rule</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>issue<span class="token punctuation">.</span>state <span class="token operator">!=</span> IssueStatus<span class="token punctuation">.</span>Resolved<span class="token punctuation">)</span><span class="token punctuation">:</span>
            issue<span class="token punctuation">.</span>mark_as_resolved<span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>resolution<span class="token punctuation">)</span>
</div></div></div></pre></div><p class="chakra-text css-rszk63">This handler violates our glue-code principle because it encodes a business rule: &quot;If an
issue is already resolved, then it can&#x27;t be resolved a second time&quot;. This rule belongs
in our domain model, probably in the <code>mark_as_resolved</code> method of our <code>Issue</code> object. I
tend to use classes for my command handlers, and to invoke them with the call magic
method, but a function is perfectly valid as a handler, too. The major reason to prefer
a class is that it can make dependency management a little easier, but the two
approaches are completely equivalent. For example, we could rewrite our
<code>ReportIssueHandler</code> like this:</p><div class="remark-highlight"><pre class="language-python"><div class="css-e69dqy"><div class="css-13wyh5o"><div class="css-0"><span class="token keyword">def</span> <span class="token function">ReportIssue</span><span class="token punctuation">(</span>issue_log<span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    reported_by <span class="token operator">=</span> IssueReporter<span class="token punctuation">(</span>
        cmd<span class="token punctuation">.</span>reporter_name<span class="token punctuation">,</span>
        cmd<span class="token punctuation">.</span>reporter_email<span class="token punctuation">)</span>
    issue <span class="token operator">=</span> Issue<span class="token punctuation">(</span>reported_by<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span>problem_description<span class="token punctuation">)</span>
    issue_log<span class="token punctuation">.</span>add<span class="token punctuation">(</span>issue<span class="token punctuation">)</span>
</div></div></div></pre></div><p class="chakra-text css-rszk63">If magic methods make you feel queasy, you can define a handler to be a class that
exposes a handle method like this:</p><div class="remark-highlight"><pre class="language-python"><div class="css-e69dqy"><div class="css-13wyh5o"><div class="css-0"><span class="token keyword">class</span> <span class="token class-name">ReportIssueHandler</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</div></div></div></pre></div><p class="chakra-text css-rszk63">However you structure them, the important ideas of commands and handlers are:</p><ol><li>Commands are logic-free data structures with a name and a bunch of values.</li><li>They form a stable, simple API that describes what our system can do, and doesn&#x27;t
depend on any implementation details.</li><li>Each command can be handled by exactly one handler.</li><li>Each command instructs the system to run through one use case.</li><li>A handler will usually do the following steps: get state, change state, persist
state, notify other parties that state was changed.</li></ol><p class="chakra-text css-rszk63">Let&#x27;s take a look at the complete system, I&#x27;m concatenating all the files into a single
code listing for each of grokking, but in the
<a target="_blank" class="chakra-link css-1ud5qxa" href="https://github.com/bobthemighty/blog-code-samples/tree/master/ports-and-adapters/01">git repository</a>
I&#x27;m splitting the layers of the system into separate packages. In the real world, I
would probably use a single python package for the whole app, but in other languages -
Java, C#, C++ - I would usually have a single binary for each layer. Splitting the
packages up this way makes it easier to understand how the dependencies work.</p><div class="remark-highlight"><pre class="language-python"><div class="css-e69dqy"><div class="css-13wyh5o"><div class="css-0"><span class="token keyword">from</span> typing <span class="token keyword">import</span> NamedTuple
<span class="token keyword">from</span> expects <span class="token keyword">import</span> expect<span class="token punctuation">,</span> have_len<span class="token punctuation">,</span> equal

<span class="token comment"># Domain model</span>

<span class="token keyword">class</span> <span class="token class-name">IssueReporter</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>email <span class="token operator">=</span> email


<span class="token keyword">class</span> <span class="token class-name">Issue</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reporter<span class="token punctuation">,</span> description<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>description <span class="token operator">=</span> description
        self<span class="token punctuation">.</span>reporter <span class="token operator">=</span> reporter


<span class="token keyword">class</span> <span class="token class-name">IssueLog</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> issue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">ReportIssueCommand</span><span class="token punctuation">(</span>NamedTuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    reporter_name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    reporter_email<span class="token punctuation">:</span> <span class="token builtin">str</span>
    problem_description<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token comment"># Service Layer</span>

<span class="token keyword">class</span> <span class="token class-name">ReportIssueHandler</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> issue_log<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>issue_log <span class="token operator">=</span> issue_log

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
        reported_by <span class="token operator">=</span> IssueReporter<span class="token punctuation">(</span>
            cmd<span class="token punctuation">.</span>reporter_name<span class="token punctuation">,</span>
            cmd<span class="token punctuation">.</span>reporter_email<span class="token punctuation">)</span>
        issue <span class="token operator">=</span> Issue<span class="token punctuation">(</span>reported_by<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span>problem_description<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>issue_log<span class="token punctuation">.</span>add<span class="token punctuation">(</span>issue<span class="token punctuation">)</span>


<span class="token comment"># Adapters</span>

<span class="token keyword">class</span> <span class="token class-name">FakeIssueLog</span><span class="token punctuation">(</span>IssueLog<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>issues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> issue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>issues<span class="token punctuation">.</span>append<span class="token punctuation">(</span>issue<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>issues<span class="token punctuation">[</span><span class="token builtin">id</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>issues<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>issues<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>


email <span class="token operator">=</span> <span class="token string">&quot;bob@example.org&quot;</span>
name <span class="token operator">=</span> <span class="token string">&quot;bob&quot;</span>
desc <span class="token operator">=</span> <span class="token string">&quot;My mouse won&#x27;t move&quot;</span>


<span class="token keyword">class</span> <span class="token class-name">When_reporting_an_issue</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">given_an_empty_issue_log</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>issues <span class="token operator">=</span> FakeIssueLog<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">because_we_report_a_new_issue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        handler <span class="token operator">=</span> ReportIssueHandler<span class="token punctuation">(</span>self<span class="token punctuation">.</span>issues<span class="token punctuation">)</span>
        cmd <span class="token operator">=</span> ReportIssueCommand<span class="token punctuation">(</span>name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> desc<span class="token punctuation">)</span>

        handler<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">the_handler_should_have_created_a_new_issue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        expect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>issues<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>have_len<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">it_should_have_recorded_the_issuer</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        expect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>issues<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reporter<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>equal<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        expect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>issues<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reporter<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>equal<span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">it_should_have_recorded_the_description</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        expect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>issues<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>equal<span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">)</span>
</div></div></div></pre></div><p class="chakra-text css-rszk63">There&#x27;s not a lot of functionality here, and our issue log has a couple of problems,
firstly there&#x27;s no way to see the issues in the log yet, and secondly we&#x27;ll lose all of
our data every time we restart the process. We&#x27;ll fix the second of those in the next
part:
<a target="_blank" class="chakra-link css-1ud5qxa" href="https://io.made.com/blog/2017-09-08-repository-and-unit-of-work-pattern-in-python.html">Repository And Unit Of Work Pattern In Python</a>.</p></div><style data-emotion="css bupnvw">.css-bupnvw{-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;background:#F8F8F8;bottom:0px;left:0px;width:100%;position:fixed;}</style><footer role="contentinfo" class="css-bupnvw"><style data-emotion="css 18ci58h">.css-18ci58h{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:var(--chakra-sizes-8xl);width:100%;margin:auto;}</style><div class="css-18ci58h"></div></footer><span></span></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"var l=Object.defineProperty,d=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;var r=(a,n,s)=\u003en in a?l(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s,e=(a,n)=\u003e{for(var s in n||(n={}))p.call(n,s)\u0026\u0026r(a,s,n[s]);if(o)for(var s of o(n))c.call(n,s)\u0026\u0026r(a,s,n[s]);return a},m=(a,n)=\u003ed(a,u(n));var i=(a,n)=\u003e{var s={};for(var t in a)p.call(a,t)\u0026\u0026n.indexOf(t)\u003c0\u0026\u0026(s[t]=a[t]);if(a!=null\u0026\u0026o)for(var t of o(a))n.indexOf(t)\u003c0\u0026\u0026c.call(a,t)\u0026\u0026(s[t]=a[t]);return s};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(s){var t=s,{components:a}=t,n=i(t,[\"components\"]);return mdx(MDXLayout,m(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,`The term DDD comes from the book by Eric Evans:\n\"`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.amazon.co.uk/Domain-driven-Design-Tackling-Complexity-Software/dp/0321125215\"}),\"Domain-Driven Design: Tackling Complexity in the Heart of Software\"),`\n\". In his book he describes a set of practices that aim to help us build maintainable,\nrich, software systems that solve customer's problems. The book is 560 pages of dense\ninsight, so you'll pardon me if my summary elides some details, but in brief he\nsuggests:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`Listen very carefully to your domain experts - the people whose job you're automating\nor assisting in software.`),mdx(\"li\",{parentName:\"ul\"},`Learn the jargon that they use, and help them to come up with new jargon, so that\nevery concept in their mental model is named by a single precise term.`),mdx(\"li\",{parentName:\"ul\"},`Use those terms to model your software; the nouns and verbs of the domain expert are\nthe classes and methods you should use in modelling.`),mdx(\"li\",{parentName:\"ul\"},`Whenever there is a discrepancy between your shared understanding of the domain, go\nand talk to the domain experts again, and then refactor aggressively.`)),mdx(\"p\",null,`This sounds great in theory, but in practice we often find that our business logic\nescapes from our model objects; we end up with logic bleeding into controllers, or into\nfat \"manager\" classes. We find that refactoring becomes difficult: we can't split a\nlarge and important class, because that would seriously impact the database schema; or\nwe can't rewrite the internals of an algorithm because it has become tightly coupled to\ncode that exists for a different use-case. The good news is that these problems can be\navoided, since they are caused by a lack of organisation in the codebase. In fact, the\ntools to solve these problems take up half of the DDD book, but it can be be difficult\nto understand how to use them together in the context of a complete system.`),mdx(\"p\",null,`I want to use this series to introduce an architectural style called\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"http://wiki.c2.com/?PortsAndAdaptersArchitecture\"}),\"Ports and Adapters\"),`, and a design\npattern named\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://matthiasnoback.nl/2015/01/responsibilities-of-the-command-bus/\"}),\"Command Handler\"),`.\nI'll be explaining the patterns in Python because that's the language that I use\nday-to-day, but the concepts are applicable to any OO language, and can be massaged to\nwork perfectly in a functional context. There might be a lot more layering and\nabstraction than you're used to, especially if you're coming from a Django background or\nsimilar, but please bear with me. In exchange for a more complex system at the outset,\nwe can avoid much of our\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"http://wiki.c2.com/?AccidentalComplexity\"}),\"accidental complexity\"),\" later.\"),mdx(\"p\",null,`The system we're going to build is an issue management system, for use by a helpdesk.\nWe're going to be replacing an existing system, which consists of an HTML form that\nsends an email. The emails go into a mailbox, and helpdesk staff go through the mails\ntriaging problems and picking up problems that they can solve. Sometimes issues get\noverlooked for a long time, and the helpdesk team have invented a complex system of\npost-it notes and whiteboard layouts to track work in progress. For a while this system\nhas worked pretty well but, as the system gets busier, the cracks are beginning to show.`),mdx(\"p\",null,`Our first conversation with the domain expert \"What's the first step in the process?\"\nyou ask, \"How do tickets end up in the mail box?\".`),mdx(\"p\",null,`\"Well, the first thing that happens is the user goes to the web page, and they fill out\nsome details, and report an issue. That sends an email into the issue log and then we\npick issues from the log each morning\".`),mdx(\"p\",null,`\"So when a user reports an issue, what's the minimal set of data that you need from\nthem?\"`),mdx(\"p\",null,`\"We need to know who they are, so their name, and email I guess. Uh... and the problem\ndescription. They're supposed to add a category, but they never do, and we used to have\na priority, but everyone set their issue to EXTREMELY URGENT, so it was useless.`),mdx(\"p\",null,'\"But a category and priority would help you to triage things?\"'),mdx(\"p\",null,'\"Yes, that would be really helpful if we could get users to set them properly.\"'),mdx(\"p\",null,\"This gives us our first use case: As a user, I want to be able to report a new issue.\"),mdx(\"p\",null,`Okay, before we get to the code, let's talk about architecture. The architecture of a\nsoftware system is the overall structure - the choice of language, technology, and\ndesign patterns that organise the code and satisfy our\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://en.wikipedia.org/wiki/Non-functional_requirement\"}),\"constraints\"),`. For our\narchitecture, we're going to try and stick with three principles:`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},`We will always define where our use-cases begin and end. We won't have business\nprocesses that are strewn all over the codebase.`),mdx(\"li\",{parentName:\"ol\"},`We will\n`,mdx(\"a\",e({parentName:\"li\"},{href:\"https://en.wikipedia.org/wiki/Dependency_inversion_principle\"}),\"depend on abstractions\"),`\n, and not on concrete implementations.`),mdx(\"li\",{parentName:\"ol\"},`We will treat glue code as distinct from business logic, and put it in an\nappropriate place.`)),mdx(\"p\",null,\"Firstly we start with the \",mdx(\"strong\",{parentName:\"p\"},\"domain model\"),`. The domain model encapsulates our shared\nunderstanding of the problem, and uses the terms we agreed with the domain experts. In\nkeeping with principle #2 we will define abstractions for any infrastructural or\ntechnical concerns and use those in our model. For example, if we need to send an email,\nor save an entity to a database, we will do so through an abstraction that captures our\nintent. In this series we'll create a separate python package for our domain model so\nthat we can be sure it has no dependencies on the other layers of the system.\nMaintaining this rule strictly will make it easier to test and refactor our system,\nsince our domain models aren't tangled up with messy details of databases and http\ncalls.`),mdx(\"p\",null,\"Around the outside of our domain model we place \",mdx(\"strong\",{parentName:\"p\"},\"services\"),`. These are stateless\nobjects that do stuff to the domain. In particular, for this system, our command\nhandlers are part of the service layer.`),mdx(\"p\",null,\"Finally, we have our \",mdx(\"strong\",{parentName:\"p\"},\"adapter\"),` layer. This layer contains code that drives the service\nlayer, or provides services to the domain model. For example, our domain model may have\nan abstraction for talking to the database, but the adapter layer provides a concrete\nimplementation. Other adapters might include a Flask API, or our set of unit tests, or a\ncelery event queue. All of these adapters connect our application to the outside world.`),mdx(\"p\",null,`In keeping with our first principle, we're going to define a boundary for this use case\nand create our first `,mdx(\"em\",{parentName:\"p\"},\"Command Handler\"),`. A command handler is an object that orchestrates\na business process. It does the boring work of fetching the right objects, and invoking\nthe right methods on them. It's similar to the concept of a Controller in an MVC\narchitecture.`),mdx(\"p\",null,\"First, we create a \",mdx(\"em\",{parentName:\"p\"},\"Command\"),\" object.\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-python\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"ReportIssueCommand\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"NamedTuple\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        reporter_name`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"str\"),`\n        reporter_email`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"str\"),`\n        problem_description`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"str\"),`\n`))),mdx(\"p\",null,`A command object is a small object that represents a state-changing action that can\nhappen in the system. Commands have no behaviour, they're pure data structures. There's\nno reason why you have to represent them with classes, since all they need is a name and\na bag of data, but a NamedTuple is a nice compromise between simplicity and convenience.\nCommands are instructions from an external agent (a user, a cron job, another service\netc.) and have names in the imperative tense, for example:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"ReportIssue\"),mdx(\"li\",{parentName:\"ul\"},\"PrepareUploadUri\"),mdx(\"li\",{parentName:\"ul\"},\"CancelOutstandingOrders\"),mdx(\"li\",{parentName:\"ul\"},\"RemoveItemFromCart\"),mdx(\"li\",{parentName:\"ul\"},\"OpenLoginSession\"),mdx(\"li\",{parentName:\"ul\"},\"PlaceCustomerOrder\"),mdx(\"li\",{parentName:\"ul\"},\"BeginPaymentProcess\")),mdx(\"p\",null,`We should try to avoid the verbs Create, Update, or Delete (and their synonyms) because\nthose are technical implementations. When we listen to our domain experts, we often find\nthat there is a better word for the operation we're trying to model. If all of your\ncommands are named \"CreateIssue\", \"UpdateCart\", \"DeleteOrders\", then you're probably not\npaying enough attention to the language that your stakeholders are using.`),mdx(\"p\",null,`The command objects belong to the domain, and they express the API of your domain. If\nevery state-changing action is performed via a command handler, then the list of\nCommands is the complete list of supported operations in your domain model. This has two\nmajor benefits:`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},`If the only way to change state in the system is through a command, then the list of\ncommands tells me all the things I need to test. There are no other code paths that\ncan modify data.`),mdx(\"li\",{parentName:\"ol\"},`Because our commands are lightweight, logic-free objects, we can create them from an\nHTTP post, or a celery task, or a command line csv reader, or a unit test. They form\na simple and stable API for our system that does not depend on any implementation\ndetails and can be invoked in multiple ways.`)),mdx(\"p\",null,\"In order to process our new command, we'll need to create a command handler.\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-python\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"ReportIssueCommandHandler\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" issue_log\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issue_log \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` issue_log\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__call__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        reported_by `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" IssueReporter\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n            cmd`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter_name\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n            cmd`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter_email\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        issue `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" Issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"reported_by\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"problem_description\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issue_log\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"add\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`))),mdx(\"p\",null,`Command handlers are stateless objects that orchestrate the behaviour of a system. They\nare a kind of glue code, and manage the boring work of fetching and saving objects, and\nthen notifying other parts of the system. In keeping with principle #3, we keep this in\na separate layer. To satisfy principle #1, each use case is a separate command handler\nand has a clearly defined beginning and end. Every command is handled by exactly one\ncommand handler.`),mdx(\"p\",null,\"In general all command handlers will have the same structure:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Fetch the current state from our persistent storage.\"),mdx(\"li\",{parentName:\"ol\"},\"Update the current state.\"),mdx(\"li\",{parentName:\"ol\"},\"Persist the new state.\"),mdx(\"li\",{parentName:\"ol\"},\"Notify any external systems that our state has changed.\")),mdx(\"p\",null,`We will usually avoid if statements, loops, and other such wizardry in our handlers, and\nstick to a single possible line of execution. Command handlers are boring glue code.\nSince our command handlers are just glue code, we won't put any business logic into\nthem - they shouldn't be making any business decisions. For example, let's skip ahead a\nlittle to a new command handler:`),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-python\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"MarkIssueAsResolvedHandler\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" issue_log\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issue_log \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` issue_log\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__call__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        issue `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issue_log\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"get\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issue_id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# the following line encodes a business rule\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"state \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"!=\"),\" IssueStatus\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"Resolved\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n            issue`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"mark_as_resolved\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"resolution\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`))),mdx(\"p\",null,`This handler violates our glue-code principle because it encodes a business rule: \"If an\nissue is already resolved, then it can't be resolved a second time\". This rule belongs\nin our domain model, probably in the `,mdx(\"inlineCode\",{parentName:\"p\"},\"mark_as_resolved\"),\" method of our \",mdx(\"inlineCode\",{parentName:\"p\"},\"Issue\"),` object. I\ntend to use classes for my command handlers, and to invoke them with the call magic\nmethod, but a function is perfectly valid as a handler, too. The major reason to prefer\na class is that it can make dependency management a little easier, but the two\napproaches are completely equivalent. For example, we could rewrite our\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ReportIssueHandler\"),\" like this:\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-python\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"ReportIssue\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"issue_log\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    reported_by `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" IssueReporter\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n        cmd`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter_name\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n        cmd`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter_email\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    issue `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" Issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"reported_by\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"problem_description\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    issue_log`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"add\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`))),mdx(\"p\",null,`If magic methods make you feel queasy, you can define a handler to be a class that\nexposes a handle method like this:`),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-python\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"ReportIssueHandler\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"handle\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n       `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),`\n`))),mdx(\"p\",null,\"However you structure them, the important ideas of commands and handlers are:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Commands are logic-free data structures with a name and a bunch of values.\"),mdx(\"li\",{parentName:\"ol\"},`They form a stable, simple API that describes what our system can do, and doesn't\ndepend on any implementation details.`),mdx(\"li\",{parentName:\"ol\"},\"Each command can be handled by exactly one handler.\"),mdx(\"li\",{parentName:\"ol\"},\"Each command instructs the system to run through one use case.\"),mdx(\"li\",{parentName:\"ol\"},`A handler will usually do the following steps: get state, change state, persist\nstate, notify other parties that state was changed.`)),mdx(\"p\",null,`Let's take a look at the complete system, I'm concatenating all the files into a single\ncode listing for each of grokking, but in the\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/bobthemighty/blog-code-samples/tree/master/ports-and-adapters/01\"}),\"git repository\"),`\nI'm splitting the layers of the system into separate packages. In the real world, I\nwould probably use a single python package for the whole app, but in other languages -\nJava, C#, C++ - I would usually have a single binary for each layer. Splitting the\npackages up this way makes it easier to understand how the dependencies work.`),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-python\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" typing \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),` NamedTuple\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" expects \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" expect\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" have_len\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),` equal\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Domain model\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"IssueReporter\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" name\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" email\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"name \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` name\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"email \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` email\n\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"Issue\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" reporter\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" description\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"description \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` description\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` reporter\n\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"IssueLog\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"add\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"pass\"),`\n\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"ReportIssueCommand\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"NamedTuple\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    reporter_name`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"str\"),`\n    reporter_email`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"str\"),`\n    problem_description`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"str\"),`\n\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Service Layer\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"ReportIssueHandler\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" issue_log\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issue_log \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` issue_log\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__call__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        reported_by `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" IssueReporter\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n            cmd`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter_name\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n            cmd`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter_email\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        issue `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" Issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"reported_by\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"problem_description\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issue_log\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"add\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Adapters\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"FakeIssueLog\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"IssueLog\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__init__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"add\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"append\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"issue\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"get\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"id\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"id\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__len__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"len\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"__getitem__\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" idx\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"idx\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n\n\nemail `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"bob@example.org\"'),`\nname `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"bob\"'),`\ndesc `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),`\"My mouse won't move\"`),`\n\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"When_reporting_an_issue\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"given_an_empty_issue_log\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        self`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" FakeIssueLog\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"because_we_report_a_new_issue\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        handler `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" ReportIssueHandler\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        cmd `,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" ReportIssueCommand\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"name\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" email\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" desc\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n        handler`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"cmd\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"the_handler_should_have_created_a_new_issue\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        expect`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"to\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"have_len\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"1\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"it_should_have_recorded_the_issuer\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        expect`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"0\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"name\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"to\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"equal\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"name\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        expect`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"0\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"reporter\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"email\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"to\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"equal\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"email\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"def\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"it_should_have_recorded_the_description\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        expect`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"self\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"issues\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"0\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"description\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"to\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"equal\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"desc\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`))),mdx(\"p\",null,`There's not a lot of functionality here, and our issue log has a couple of problems,\nfirstly there's no way to see the issues in the log yet, and secondly we'll lose all of\nour data every time we restart the process. We'll fix the second of those in the next\npart:\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://io.made.com/blog/2017-09-08-repository-and-unit-of-work-pattern-in-python.html\"}),\"Repository And Unit Of Work Pattern In Python\"),\".\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"date":"2017-09-07","title":"Introducing the command handler","layout":"post","author":"Bob","categories":["ports \u0026 adapters"],"tags":["python","architecture"]},"__N_SSG":true},"page":"/[slug]","query":{"slug":"2017-09-07-introducing-command-handler"},"buildId":"raNWymQ2sbqOLS7OjHD3m","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>